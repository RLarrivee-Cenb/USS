C
	PROGRAM	DTUBE	!DAVIS TUBE
C
C	PROGRAM IS USED BY 6TH FLOOR LAB CLERKS TO INPUT DAVIS TUBE
C	NUMBERS FOR THE VAX STREND FILE
C
	IMPLICIT NONE
C
	INTEGER*4	I,J,K,L,M,N,MX
	INTEGER*4	CHR(10),FLAG,LEN,UFO_OPEN
C
	REAL*4		DTR,DTS,VALU(24)
C
	CHARACTER*1	OPT
	CHARACTER*3	MTH(12)/'JAN','FEB','MAR','APR',
	1			'MAY','JUN','JUL','AUG',
	1			'SEP','OCT','NOV','DEC'/
	CHARACTER*12	WORDS(10),SDATE
	CHARACTER*12	DATEX
	CHARACTER*4	CLEAR/' [2J'/
	CHARACTER*3	HOME/' [H'/
	CHARACTER*100	KEYBD,BLANK
	CHARACTER*15	FILEX/'LOGS:STREND.DAT'/
C
	EXTERNAL	UFO_OPEN
C
	CLEAR(1:1)=CHAR(27)
	HOME(1:1)=CHAR(27)
C
	DO 10 I=1,100
		BLANK(I:I)=' '	!SET UP BLANKS FOR INPUT BUFFER
10	CONTINUE
C
	OPEN	(UNIT=6,FILE='SYS$COMMAND',STATUS='UNKNOWN')
C
	OPEN	(UNIT=1,FILE='LOGS:STREND.DAT',
	1	ACCESS='DIRECT',
	1	STATUS='OLD',RECORDTYPE='FIXED',RECL=27,SHARED,
	1	FORM='UNFORMATTED',USEROPEN=UFO_OPEN)
C
100	CONTINUE
C
	CALL	CLRSCREEN
C
110	CONTINUE
C
	WRITE	(6,125)
125	FORMAT	(' PLEASE SELECT YOUR OPTION... I - INPUT A SHIFT',/
	1	 '                              D - DISPLAY A SHIFT',/
	1	 ' OR TYPE <RETURN> TO QUIT')
C
	READ	(6,150)LEN,OPT
150	FORMAT	(Q,A)
C
	IF (LEN .EQ. 0)GOTO 99999	!GO HERE TO SHUT OFF
C
200	CONTINUE
C
	CALL	CLRSCREEN
C
210	CONTINUE
C
	WRITE	(6,300)
300	FORMAT	(' PLEASE TYPE DATE IN THIS FORM MM-DD-YYYY'/,
	1	 ' OR <RET> FOR PREVIOUS PROMPT')
C
	KEYBD=BLANK
C
	READ	(6,150)LEN,KEYBD 	!GET DATE
C
	IF (LEN .EQ. 0)GOTO 100	!GO BACK TO PREVIOUS PROMPT
C
	CALL	READKEYBD(KEYBD,WORDS,CHR)
C
	CALL	OTS$CVT_TI_L(WORDS(1),MX,,%VAL(1))	!MTH TO INTEGER
C
	DATEX(1:2)=WORDS(2)(1:2)	!BUILD SEARCH DATE
	DATEX(3:3)='-'
	DATEX(4:6)=MTH(MX)
	DATEX(7:7)='-'
	DATEX(8:11)=WORDS(3)(1:4)
	IF (DATEX(2:2) .EQ. ' ')THEN
		DATEX(2:2)=DATEX(1:1)
		DATEX(1:1)='0'
	END IF
C
	FLAG=0
C
390	CONTINUE
C
	IF (OPT .EQ. 'I')THEN
		WRITE	(6,400)
400		FORMAT	(/' PLEASE TYPE SHIFT,DT%REC,DT%SIO2'/,
	1		 '  OR PUSH <RET> FOR PREVIOUS PROMPT')
C
		KEYBD=BLANK
C
		READ	(6,150)LEN,KEYBD 	!GET SHIFT AND DATA
C
		IF (LEN .EQ. 0)GOTO 200	!GO BACK TO PREVIOUS PROMPT
C
		CALL	READKEYBD(KEYBD,WORDS,CHR)
C
		DATEX(12:12)=WORDS(1)(1:1)
C
		READ	(WORDS(2),'(BN,F12.0)')DTR     !DT%REC
		READ	(WORDS(3),'(BN,F12.0)')DTS     !DT%SIO2
C
	END IF
C
	DO 500	N=1,100
C
		READ	(1,REC=N)SDATE,VALU
C
		IF (SDATE(1:11) .NE. DATEX(1:11))GOTO 500!NO MATCH CONTINUE
C
		IF (OPT .EQ. 'I')THEN
			IF (SDATE(12:12) .NE. DATEX(12:12))THEN
				GOTO 500
			ELSE
				VALU(14)=DTR
				VALU(15)=DTS
				WRITE	(1,REC=N)SDATE,VALU
				GOTO 390
			END IF
		END IF
C
		IF (OPT .EQ. 'D')THEN
C
			IF (FLAG .EQ. 0)THEN
C
			WRITE	(6,325)
325			FORMAT	(/' ',4X,'DATE',5X,'SHIFT',3X,'DT %REC',
	1			 3X,'DT %SIO2'/)
			FLAG=1
C
			END IF
C
			WRITE	(6,335)SDATE(1:11),SDATE(12:12),VALU(14),
	1				VALU(15)
335			FORMAT	(' ',1X,A,3X,A,7X,F6.2,6X,F5.2)
C
			GOTO 500
C
		END IF
C
500	CONTINUE
C
	IF (FLAG .EQ. 0)THEN
		WRITE	(6,600)
600		FORMAT	(/'  CANNOT FIND THIS DATE!!!   TRY AGAIN')
C
		GOTO 210
C
	END IF
C
	IF (OPT .EQ. 'D')THEN
		WRITE	(6,625)
625		FORMAT	(/' PUSH <RET> FOR PREVIOUS PROMPT')
		READ	(6,630)LEN,KEYBD
630		FORMAT	(Q,A)
		GOTO 200
	END IF
C
99999	CONTINUE
C
	CLOSE	(UNIT=1)
	CLOSE	(UNIT=6)
C
	CALL	EXIT
C
	END
C
	SUBROUTINE	CLRSCREEN
C
	CALL	LIB$ERASE_PAGE(1,1)
	CALL	LIB$SET_CURSOR(1,1)
C
	RETURN
	END
C
	SUBROUTINE	READKEYBD(KEYBD,WORDS,CHR)
C
	IMPLICIT NONE
C
	CHARACTER*100	KEYBD
	CHARACTER*12	WORDS(10)
	INTEGER*4	CHR(10)
C
	INTEGER*4	I,J,K,L
C
	DO 5000	I=1,10
		WORDS(I)='            '
		CHR(I)=0
5000	CONTINUE
C
	J=1
	K=1
C
	DO 6000 I=1,100
		IF (KEYBD(I:I) .EQ. ' ')GOTO 6000
		IF ((KEYBD(I:I) .EQ. '-').OR.(KEYBD(I:I) .EQ. ','))THEN
			J=J+1
			K=1
		ELSE
			WORDS(J)(K:K)=KEYBD(I:I)
			K=K+1
			CHR(J)=CHR(J)+1
		END IF
6000	CONTINUE
	RETURN
	END
