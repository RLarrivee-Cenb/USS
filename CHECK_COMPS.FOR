	INCLUDE 'FMS$EXAMPLES:FDVDEF'
C
C
	DOUBLE PRECISION SUM(3),SUM2(3)
C
	INTEGER  WORKSPACE( 3 ),	!General workspace
	1	 CHECKWKSP( 3 ),	!Check workspace
	2	 TCA( 3 ),NN(3)
C
	CHARACTER MON(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL',
	1	'AUG','SEP','OCT','NOV','DEC'/,RMD*11,REPD*11,LSD*11,
	1	KFILE(17)*11,KN*9,AZ*3,AVG(3)*5,AVG2(3)*6,ERRO*80
C
	
C
	DOUBLE PRECISION DSUM,DSUM2,DMIN,DMAX,D200,C200,MEAN,STDEV
C
	DOUBLE PRECISION ZJ,FJ,B6,TJ,B1,B2,B3,B4,B5,MEAN6,SD6,C2006
C
C
C
C
	STRUCTURE /CT2/
C
		CHARACTER*9	KEY		!YYMMDD LINE SHIFT HALF
		REAL		VALUES(100)
		REAL		MEAN,SD,CA200,A200,MIN,MAX,NUM
		INTEGER		SAMPLE
		INTEGER		REP
C
	END STRUCTURE
C
	RECORD /CT2/ CT2,ctz
C
c
c
	STRUCTURE /CT2x/
C
		CHARACTER*9	KEY		!YYMMDD LINE SHIFT HALF
		REAL		MEAN,SD,CA200,A200,MIN,MAX,NUM
		INTEGER		SAMPLE
		INTEGER		REP
C
	END STRUCTURE
c
	RECORD /CT2X/   SAV(100),SAVX,SAVZ
c
	INTEGER PASS,BONE(2),BDAY(2),T1,T2,T3,TNUM,TCNT,NCNT(3,20)
C
	CHARACTER AA*6,A12*12,A23*23,KY2*9,A7*7,OLDKEY*9,ADAY/'1'/,
	1	LINES(3,20)*1,MEANS(3,20)*6,M200(3,20)*6,LSL,LSM*5,LS2*6
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
	LSTART=1
	LSTART2=1
	LSTART3=1
C
	T1=0
	T2=0
	T3=0
C
	DO 80 L=1,3
	DO 80 M=1,20
		LINES(L,M)=' '
		MEANS(L,M)='     '
80		M200(L,M)='      '
C
	CALL SYS$BINTIM (ADAY,BONE)
C
		!Terminal Control Area
C
	CALL FDV$ATERM( %DESCR(TCA),12 ,2)
	CALL FDV$AWKSP( %DESCR(WORKSPACE), 2000 )
	CALL FDV$LOPEN( 'D_I:CHECK', 1 )
C	CALL FDV$SPADA( 0 )
C	CALL FDV$SSIGQ( 0 )
C
	DO 13 I=1,17
13		KFILE(I)='           '
C
C
C
C
C
	OPEN (UNIT=11,FILE='D_I:COMPSAVE.DAT',ORGANIZATION='INDEXED',
	1		FORM='UNFORMATTED',ACCESS='KEYED',RECL=128,
	1		RECORDTYPE='FIXED',SHARED,READONLY,
	1		STATUS='UNKNOWN',KEY=(1:9:CHARACTER))
C
C
C
	OLDSAMPLE=0
C
C
C
C
C	HE WANTS TO ENTER DATE, ETC. 
C
30	OLDSAMPLE=1	! SET TO SHOW THIS SAMPLE WAS ALREADY STORED
C
C
	CALL SYS$ASCTIM (,A23,,)
C
	CALL FDV$CDISP ('CHECK')
C
1	IF (A23(1:1) .EQ. ' ') A23(1:1)='0'
C
C
	MM=0
C
C
	DO 22 I=1,12
		IF (MON(I) .EQ. A23(4:6)) GO TO 23
22	CONTINUE
	STOP
C
23	WRITE (AA(3:4),'(I2)') I
	IF (AA(3:3) .EQ. ' ') AA(3:3)='0'
C
	AA(5:6)=A23(1:2)
	AA(1:2)=A23(10:11)
C
C
	KY2=AA(1:6)//'   '
C
C
C
	ipass=0
C
1818    if (ipass .eq. 0) then
	READ (11,KEYGE=KY2,IOSTAT=MMX) CT2
	IPASS=1
	else
	read (11,iostat=MMX) CT2
	END IF
C
	UNLOCK (11)
C
	IF (MMX .EQ. 52) THEN
		CALL FDV$PUTL ('COMPRESSION FILE IN USE- TRY LATER')
		GO TO 99
	END IF
C
	IF (MMX .NE. 0) GO TO 350
C
	IF (CT2.KEY(1:6) .NE. KY2(1:6)) THEN 
		SAVX.KEY=CT2.KEY
		SAVX.MEAN=CT2.MEAN
		SAVX.A200=CT2.A200
		SAVX.SAMPLE=CT2.SAMPLE
		SAVX.NUM=CT2.NUM
		GO TO 350
	END IF 
C
C
C
	MM=MM+1
C
	SAV(MM).KEY=CT2.KEY
	SAV(MM).MEAN=CT2.MEAN
	SAV(MM).A200=CT2.A200
	SAV(MM).SAMPLE=CT2.SAMPLE
	SAV(MM).NUM=CT2.NUM
C
	GO TO 1818
C
C
C
C
350	DO 225 LX=MM,1,-1
C
C
	IF (SAV(LX).SAMPLE .GE. 300) THEN
		T3=T3+1
		IF (T3 .GT. 20) THEN
			T3=20
			GO TO 222
		END IF
		TNUM=3
		TCNT=T3
	ELSE IF (SAV(LX).SAMPLE .GE. 200) THEN
		T2=T2+1
		IF (T2 .GT. 20) THEN
			T2=20
			GO TO 222
		END IF
		TNUM=2
		TCNT=T2
	ELSE IF (SAV(LX).SAMPLE .GE. 100) THEN
		T1=T1+1
		IF (T1 .GT. 20) THEN
			T1=20
			GO TO 222
		END IF
		TNUM=1
		TCNT=T1
	ELSE
		CALL FDV$PUTL ('SAMPLE NO. NOT BETWEEN 100 & 300')
		CALL FDV$WAIT
		STOP
	END IF
C
C
	LINES(TNUM,TCNT)=SAV(LX).KEY(7:7)
	WRITE (MEANS(TNUM,TCNT),'(F6.1)',ERR=2227) SAV(LX).MEAN
	WRITE (M200(TNUM,TCNT),'(F6.2)',err=2227) SAV(LX).A200
	NCNT(TNUM,TCNT)=SAV(LX).NUM
	go to 222
C
2227	WRITE (ERRO(70:80),'(I6)') SAV(LX).SAMPLE
	ERRO='SAMPLE NO. '//ERRO(70:80)//'  HAS A BAD NUMBER'
	CALL FDV$PUTL (ERRO)
	CALL FDV$WAIT ()
C
222	IF (T1 .GE. 20 .AND. T2 .GE. 20 .AND. T3 .GE. 20) GO TO 400
C
C
225	CONTINUE
C
C
	CALL SYS$BINTIM (A23,BDAY)
	CALL LIB$SUB_TIMES (BDAY,BONE,BDAY)
	CALL SYS$ASCTIM (,A23,BDAY,)
	DO 44 I=1,100
44	SAV(I)=SAVZ
	GO TO 1
C
C
400	CLOSE (11)
C
C
C
	NN(1)=0
	NN(2)=0
	NN(3)=0
C
	DO 450 J=1,3
	DO 449 K=1,20
		READ (MEANS(J,K),'(F6.0)',IOSTAT=LL2) X	
		READ (M200(J,K),'(F6.0)') Y	
C
		SUM(J)=SUM(J)+X*NCNT(J,K)
		SUM2(J)=SUM2(J)+Y*NCNT(J,K)
		NN(J)=NN(J)+NCNT(J,K)
C
449		CONTINUE
450	CONTINUE
C
C
	DO 460 J=1,3
		SUM(J)=SUM(J)/NN(J)
		SUM2(J)=SUM2(J)/NN(J)
		X7=SUM(J)
		X8=SUM2(J)
		WRITE (AVG(J),'(F5.1)') X7
		WRITE (AVG2(J),'(F6.2)') X8
460	CONTINUE
C
	X12=18
	X13=40
C
   	DO 500 L=1,20
C
	CALL FDV$PUT (LINES(1,L),'LINE',L)
	CALL FDV$PUT (MEANS(1,L),'MEAN',L)
	LV=4
	MLV=-4
	READ (MEANS(1,L),'(F6.0)')AM
	IF (AM .LT. 400) THEN
		CALL FDV$AFVA(LV,'MEAN',L)
	ELSE
		CALL FDV$AFVA(MLV,'MEAN',L)
	END IF
	CALL FDV$PUT (M200(1,L),'M200',L)	
C
3728	CALL FDV$PUT (LINES(2,L),'LINE2',L)
	CALL FDV$PUT (MEANS(2,L),'MEAN2',L)
	LV=4
	MLV=-4
	READ (MEANS(2,L),'(F6.0)')AM
	IF (AM .LT. 400) THEN
		CALL FDV$AFVA(LV,'MEAN2',L)
	ELSE
		CALL FDV$AFVA(MLV,'MEAN2',L)
	END IF
	CALL FDV$PUT (M200(2,L),'M2002',L)	
C
	CALL FDV$PUT (LINES(3,L),'LINE3',L)
	CALL FDV$PUT (MEANS(3,L),'MEAN3',L)
	LV=4
	MLV=-4
	READ (MEANS(3,L),'(F6.0)')AM
	IF (AM .LT. 400) THEN
		CALL FDV$AFVA(LV,'MEAN3',L)
	ELSE
		CALL FDV$AFVA(MLV,'MEAN3',L)
	END IF
	CALL FDV$PUT (M200(3,L),'M2703',L)	
C
500	CONTINUE
C
	CALL FDV$PUT (AVG(1),'AVG')
	CALL FDV$PUT (AVG2(1),'AM200')
	CALL FDV$PUT (AVG(2),'AVG2')
	CALL FDV$PUT (AVG2(2),'AM2002')
	CALL FDV$PUT (AVG(3),'AVG3')
	CALL FDV$PUT (AVG2(3),'AM2003')
C
	CALL FDV$PUTL ('         PUSH <RETURN> TO QUIT,  PUSH <F2> TO PRINT')
	CALL FDV$WAIT
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
99	CALL FDV$LCLOS
	CALL FDV$SPADA (0)
	CALL FDV$DEL ('D_I:CHECK')
	CALL FDV$DWKSP (%DESCR(WORKSPACE))
	CALL FDV$DTERM(%DESCR(TCA))
	STOP
	END
