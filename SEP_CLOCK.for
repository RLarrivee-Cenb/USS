C
	PROGRAM	SEP_CLOCK	!SEPARATORS CLOCK
C
C	LINK SEP_CLOCK,SEP_CLOCK/OPT
C
	IMPLICIT NONE
C
	INCLUDE	'($PRCDEF)'
C
	INTEGER*4	I,J,K,N,UFO_OPEN
	INTEGER*4	CXSTS(100),BIT
	INTEGER*4	SECS,PM2230/81000/,PM2400/86400/
	INTEGER*4	CNTR,FIVMIN/300/,TEMP,ADRS(2)
	INTEGER*4	CX(546)/1763,1764,1767,1768,1765,1766,1761,1762,
	1			379,383,380,384,381,1803,382,1804,
	1			385,386,387,388,389,390,1832,1833,
	1			391,392,393,394,395,396,1365,1368,
	1			397,398,399,400,401,402,61,62,
	1			403,404,405,406,407,408,242,243,
	1			409,410,411,412,413,414,89,90,
	1			415,416,417,418,419,420,103,104,
	1			421,422,423,424,425,426,230,231,
	1			427,428,429,430,431,432,142,143,
	1			433,434,435,436,437,438,439,440,
	1			441,442,443,444,445,446,447,448,
	1			449,450,451,452,453,454,455,456,
	1			457,458,459,460,461,462,463,464,
	1			465,466,467,468,469,470,471,472,
	1			473,474,475,476,477,478,479,480,
C
	1			667,668,670,672,375,376,377,378,
	1			669,1805,1806,1807,671,1808,1809,1810,
	1			673,674,675,676,1834,1835,1836,1837,
	1			677,678,679,680,1820,1821,1822,1823,
	1			681,682,683,684,63,65,66,67,
	1			685,686,687,688,244,340,342,348,
	1			689,690,691,692,91,93,94,95,
	1			693,694,695,696,105,107,108,109,
	1			697,698,699,700,232,336,338,1325,
	1			701,702,703,704,131,132,133,135,
	1			705,706,707,708,709,710,711,712,
	1			713,714,715,716,717,718,719,720,
	1			721,722,723,724,725,726,727,728,
	1			729,730,731,732,733,734,735,736,
	1			737,738,739,740,741,742,743,744,
	1			745,746,747,748,749,750,751,752,
C
	1		973,974,975,976,977,978,979,980,982,984,986,988,
	1		981,1811,1812,983,1813,1814,985,1815,1816,987,1817,1818,
	1		989,990,991,992,993,994,995,996,1838,1839,1840,1841,
	1	997,998,999,1000,1001,1002,1003,1004,1824,1825,1826,1827,
	1	1005,1006,1007,1008,1009,1010,1011,1012,69,70,72,73,
	1	1013,1014,1015,1016,1017,1018,1019,1020,350,545,547,557,
	1	1021,1022,1023,1024,1025,1026,1027,1028,97,98,100,101,
	1	1029,1030,1031,1032,1033,1034,1035,1036,111,112,114,115,
	1	1037,1038,1039,1040,1041,1042,1043,1044,1326,1383,1386,890,
	1	1045,1046,1047,1048,1049,1050,1051,1052,136,137,139,140,
	1	1053,1054,1055,1056,1057,1058,1059,1060,1061,1062,1063,1064,
	1		1065,1066,1067,
	1	1068,1069,1070,1071,1072,1073,1074,1075,1076,1077,1078,1079,
	1		1082,1080,1081,
	1	1083,1084,1085,1086,1087,1088,1089,1090,1091,1092,1093,1094,
	1		1095,1096,1097,
	1	1098,1099,1100,1101,1102,1103,1104,1105,1106,1107,1108,1109,
	1		1110,1111,1112,
	1	1113,1114,1115,1116,1117,1118,1119,1120,1121,1122,1123,1124,
	1		1125,1126,1127,
	1	1128,1129,1130,1131,1132,1133,1134,1135,1136,1137,1138,1139,
	1		1140,1141,1142,
C
	1	       -969,-970,-971,-972,-977,-978,-979,-980,
C
	1		1349,1350,1351,1352,
	1		1354,1355,1357,1358,
	1		1360,1361,1363,1364,
	1		1366,1367,1369,1370,
	1		1372,1373,1375,1376,
	1		1378,1379,1381,1382,
	1		1384,1385,1387,1388,
	1		1390,1391,1393,1394,
	1		1396,1397,1399,1400,
	1		1401,1402,1403,1404,
	1		1407,1408,1409,1410,
	1		1411,1412,1413,1414,
	1		1415,1416,1417,1418,
	1		1419,1420,1421,1422,
	1		1423,1424,1425,1426,
	1		1427,1428,1429,1430,
C
	1		-1339,-1340,-1341,-1342,-1343,-1344,-1345,-1346/
C
	INTEGER*4	CXO(18)/0,0,205,209,213,217,221,225,229,233,
	1			237,241,245,250,255,260,265,270/
C
	REAL*4		RSECS,OHRS(2)
C
	CHARACTER*8	TIM/'0 0:5:00'/
	CHARACTER*14	PRGNAM/'MAGSEP:MSEPZ'/
	CHARACTER*5	PRCNAM/'MSEPZ'/
	CHARACTER*12	ENUM
C
	COMMON/CONTACTSCNC/CXSTS
C
	EXTERNAL	UFO_OPEN
C
	RSECS=SECNDS(0.0)	!SECONDS SINCE MIDNIGHT
	SECS=RSECS		!CONVERT TO INTEGER
	TEMP=PM2230-SECS	!CALCULATE FIVE MINUTE SCANS TILL 10:30PM
	IF (TEMP .LT. 0)TEMP=TEMP+PM2400
	CNTR=TEMP/FIVMIN
C
	CALL	SYS$BINTIM(TIM,ADRS)
	CALL	SYS$SCHDWK(,,ADRS,ADRS)	!SCHEDULE 5 MIN WAKEUP
C
200	CONTINUE
C
	OPEN	(UNIT=1,FILE='MAGSEP:SEP_CLOCK.DAT',
	1	STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1	RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C

	DO 1000	I=1,546	!FOR EACH MAGSEP
C
		READ	(1,REC=I)ENUM,OHRS	!OPER TIME FOR THIS MAGSEP
C
		CALL	OTS$CVT_TI_L(ENUM(5:6),N,,%VAL(1))	!GET LINE #
C
		IF (CX(I) .LT. 0)GOTO 400	!IF FLOTATION SKIP FEED CHECK
C
		J=(CXO(N)/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(CXO(N),32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 0)GOTO 1000	!NO FEED IN CIRCUIT
C
400		CONTINUE
C
		J=(ABS(CX(I))/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(ABS(CX(I)),32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 1)THEN
			OHRS(1)=OHRS(1)+0.08331	!5 MIN OF OPER TIME
			WRITE	(1,REC=I)ENUM,OHRS	!CHANGE RECORD
		END IF
C
1000	CONTINUE
C
	CLOSE	(UNIT=1)
C

	CNTR=CNTR-1	!DECREMENT SCAN COUNTER
C
	IF (CNTR .LE. 0)THEN
		CNTR=288	!RESET SCAN COUNTER
C
		OPEN	(UNIT=1,FILE='MAGSEP:SEP_CLOCK.DAT',
	1		STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1		RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C
		DO 1200	I=1,546
			READ	(1,REC=I)ENUM,OHRS
			OHRS(2)=OHRS(1)  	!SAVE 24 HR RESULTS
			OHRS(1)=0		!ZERO NEW 24 HR PERIOD
			WRITE	(1,REC=I)ENUM,OHRS
1200		CONTINUE
C
		CLOSE	(UNIT=1)
C
		CALL	SYS$CREPRC(,PRGNAM,,,,,,PRCNAM,%VAL(4),,,
	1		%VAL(PRC$M_DETACH.OR.PRC$M_NOACNT))
C
	END IF
C
	CLOSE	(UNIT=1)
C
	CALL	SYS$HIBER()
	GOTO 200
C
	END
