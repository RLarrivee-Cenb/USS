CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		SHIFTGET.FOR
C
C		RJM 30-JAN-1990
C
C
C	LINK SHIFTGET,D_I:AGD/OPT
C
C
C	HEY BOB!  REMEMBER THAT BOTH THIS PROGRAM AND 'AUTOSTART' HAVE
C	TO BE START FROM THE SAME PROCESS OR SYS$WAKE WILL NOT WORK!!!
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	
	IMPLICIT INTEGER (A-Z)      
C
	EXTERNAL UFO_OPEN
C
	INCLUDE '($PRCDEF)'
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	LIST OF FOREMEN
C
C
	CHARACTER FORM(4,2)*10
	1	/'KOSKI     ','WILEN     ','MOE       ','BELLEVILLE',
	1	'DOWNING   ','ERICKSON  ','MOYLE     ','PULIS     '/,
C
	1	KY*6,
	1 MN(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG',
	1 	   'SEP','OCT','NOV','DEC'/
C
C
C
C
	CHARACTER ADATE*11
	INTEGER SS(4),NOFD,FNOFD(4),CTIM(2)
	INTEGER*2 NUM(7)
	INTEGER LIST(28)
	1	/1,1,1,1,1,1,1,0,0,0,0,3,3,3,3,3,3,3,0,2,2,2,2,2,2,2,0,0/
C
	CHARACTER*11   			                         
	1	FORD(4)/
	1	'11-MAY-1990',  	! #1  date that each of the four 
	2	'25-MAY-1990',      	! #2  crews start their midnight
	3	'04-MAY-1990',      	! #3   shift (shift 1)
	4	'18-MAY-1990'/          ! #4
C
C

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	INTEGER BTIM(2)
C
	CHARACTER MHR*2,MINIT*2,TT*7,DAY1*1/'1'/,TTIME*16,ASHIFT*4,SINP,
	1	DATTIM*23,ATIM*11
C
C
C
	INTEGER DATF(2),IS,IH
C
 	DOUBLE PRECISION CT(18),FT(18),SCREEN(14,3,2,5),COMP(2,3,2,5),
	1  CAB(2,3,5),SIL(3,5),FILT2(5,3),BL2,FILT3(5,3),BL3,TOTAL,
	1  H2O,RMF,FTMF,BOIC(150),HOIC(150),CX(5),MX(5),AX(5),SX(5),
	1  FLUXG,P34,P12,FCA(2,3),FMG(2,3),FAL(2,3),FSI(2,3),
	1  SUMB(5),SUMA(5)
C
C
C
C
C
	STRUCTURE /FOREMAN/
C
		CHARACTER DATE*6        ! KEY 0  DATE (YYMMDD)
		CHARACTER  NAME(3,2)*10	! names by shift
		REAL TONS(5,3)          ! pellet tons
		REAL TIME(5,3)          ! grate hours
		CHARACTER FA(5,3)	! F=FLUX, A=ACID
		REAL MBTU(5,3)          ! btus/ton
		REAL BENT(5,3)          ! bent. lbs/ton
C
		REAL BT(5,3)		! before tumble +1/4
		REAL AT(5,3)		! after tumble +1/4
		REAL COMP(5,3)          ! compression
		REAL PBA(5,3)           ! filter b/a
		REAL PSIL(5,3)		! non-existent
		REAL FCR(2,3)           ! filter cake ratio
C
	END STRUCTURE
C
	RECORD /FOREMAN/ FOR,ZFOR
C
C
C
	STRUCTURE /SHIFT/
C
C
	CHARACTER*6 DATES
	INTEGER SHIFT
	INTEGER TANK(6)
	CHARACTER BINS(5)*3
	REAL    PROD(5)
	INTEGER FILOP(3)
	INTEGER FILAV(3)
	INTEGER	VAC(3)
	REAL TRIPH20(3),FILTR(3),TOT203(3),CSIO2(3),RECOV(3),GRIND(3),
	1	BTA(3),RATIO(3),RECI(3),RECO(3),GRATEHR(5),BALLHR(5),
	1	WOODT(5),COALT(5),GASCF(5),PELTYP(5),RECBAL(5),
	1	FORECAST(2),ACTUAL(2)
C
	REAL PTONS(5),BENT(5),MBTU(5),BT(5),AT(5),Q(5),CMP(5),M200(5),
	1	BZ(5),KE(5),PRE(5),UGR(5),DD1(5),DD2(5),GSPD(5),BED(5),
	1	HITMP(5),MICRO(5)
C
	CHARACTER EQUIP(5,5)*13,
	1	STOP(5,5)*5,
	1	START(5,5)*5,
	1	MSG(5,5)*40/25*' '/
C
	CHARACTER DSTART(6,5)*5,DSTOP(6,5)*5,DTIME(6,5)*5,DMSG(6,5)*50
C
	REAL DMBTU(5)
C
	CHARACTER YR*4
C
	END STRUCTURE
C
C
C
	RECORD /SHIFT/ DATA
C
C
C
C
	CHARACTER DX*12,AJ
C
	REAL A,B
C
	DOUBLE PRECISION X(91),VL(200) 
C
	INTEGER PTRH(30),BD(2),RTIM(2),INTV(2),YSTRDAY(2)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		IMMEDIATE analog @ digital pt nos.
	INTEGER
	1	TNKS(4)		/14,28,37,708/,
	1	FILT1(7)	/76,77,78,79,223,200,201/,
	1	FILT2X(10)	/763,764,765,766,767,
	1			 768,769,770,771,772/,
	1	VAC1(6)		/33,34,35,37,38,217/,
	1	VAC2(10)	/712,713,714,715,716,717,718,719,
	1			 720,721/	
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		HOURLY ANALOG VALUES
C
	INTEGER
	1	TOT20312/694/, TOT2033/680/,
	1	GB(3)/870,337,338/,
	1	BZSP(3)/891,666,667/,
	1	KESP(3)/890,578,612/,
	1	PHF(3)/893,663,617/,
	1	UGE(3)/0,584,616/, UGW(3)/887,580,614/,
	1	DD1(3)/733,123,240/, DD2(3)/0,63,179/,
	1	GSPD(3)/745,75,191/, BED(3)/886,575,609/
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		SHIFT ANALOG VALUES
C
	INTEGER
	1	RECL(2)/490,536/, TOPILE(2)/492,504/,
	1	PTNS(3)/867,339,340/,
	1	BENT(3)/876,362,363/,
	1	BZTEMP(3)/824,92,208/,
	1	KESET(3)/890,578,612/,
	1	GH(3)/1063,1001,1002/,
	1	BDH3(4)/1064,1065,1066,1067/,
	1	BDH4(5)/1003,1004,1005,1006,1007/,
	1	BDH5(5)/1008,1009,1010,1011,1012/,
	1	GCF(3)/1070,1051,1052/,
	1	WTNS(3)/1071,1047,1048/	
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	CHARACTER TIMBUF*23,DATEX*12
C
C
C
	CHARACTER ASTIM*14 /'-- 06:34:00.00'/, AINTV*7 /'0 08:00'/,
	1	FN*21 /'USER_D:[METREP]AMBMCC'/,  DAT*4/'.DAT'/,
	1       AD*23, FNM*33, AYSTR*23 ,FNDSTRNG*33
C
	REAL ANVAL(1200),MBTUS(5)
	INTEGER CXSTS(100)
C
C
	COMMON /CONTACTS/CXSTS,/ANVALTBL/ANVAL
C
C
	CALL SYS$GETTIM (BD)
	CALL SYS$ASCTIM (,AD,,)	!get current date-time in ascii
C
C
C	set time to next shift in case of restart
C
	IF (AD(13:17) .GT. '22:50') THEN
		AD(13:14)='06'
	ELSE IF (AD(13:17) .GT. '14:50') THEN
		AD(13:14)='22'
	ELSE IF (AD(13:17) .GT. '06:50') THEN
		AD(13:14)='14'
	ELSE
		AD(13:14)='06'
	END IF
C
	ASTIM=ASTIM(1:3)//AD(13:14)//ASTIM(6:14)
C
	CALL SYS$BINTIM (ASTIM,RTIM) !convert XX:31 time to binary
C
	CALL SYS$BINTIM (AINTV,INTV) !convert 8 hr interval to binary
C
	CALL SYS$SCHDWK (,,RTIM,INTV) !sched. a wakeup at 22:31,6:31,14:31
C
C	
C
2500	CALL SYS$GETTIM (BD)
	CALL SYS$ASCTIM (,AD,,)	!get current date-time in ascii
C
C
C
	IF (AD(1:1) .EQ. ' ') AD(1:1)='0'
C
C
C
C
	IF (AD(13:14) .EQ. '22') THEN
		JSHIFT=3
	ELSE IF (AD(13:14) .EQ. '06') THEN
		JSHIFT=1
	ELSE IF (AD(13:14) .EQ. '14') THEN
		JSHIFT=2
	ELSE
		GO TO 3000
	END IF
C
C
C
C
C
4661	OPEN (UNIT=10,FILE='LOGS:HOUR.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=11,FILE='LOGS:SHIFT.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=12,FILE='LOGS:DAY.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
C
C
	LCNT=0
1788	OPEN (75,FILE='MET_P:AGSHIFT.DAT',FORM='UNFORMATTED',
	1	ACCESS='DIRECT',STATUS='UNKNOWN',RECL=2048,ERR=88)
C
C
	GO TO 2540
C
C
C
88		LCNT=LCNT+1
C
		CALL LIB$WAIT (10.)
C
C
		GO TO 1788
C
C
2540	READ (75,REC=JSHIFT)DATA
C
C
	DATA.SHIFT=JSHIFT
	DATA.DATES=AD(1:6)
	DATA.YR=AD(8:11)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C		BTUS (FROM WJB)
C
	IM=0
C
C
9011	OPEN (UNIT=55,FILE='LOGS:MBTUS.DAT',STATUS='OLD',RECL=8,
	1	FORM='UNFORMATTED',RECORDTYPE='FIXED',
	1	ACCESS='DIRECT',ERR=996)
C
	READ (55,REC=1,ERR=411)DATEX,MBTUS
C
C
	WRITE (AJ,'(I1)')JSHIFT
C
	IF (DATEX(12:12) .NE. AJ) THEN
C
996		CLOSE (55)
		CALL LIB$WAIT (10.)
		IM=IM+1
		IF (IM .GT. 42) GO TO 411
		GO TO 9011
C
	END IF
C
C
	DO 377 I=1,5
	DATA.MBTU(I)=MBTUS(I)
377	CONTINUE
C
	IF (JSHIFT .NE. 3) GO TO 411
C
	READ (55,REC=2,ERR=411)DATEX,MBTUS
C
	DO 2345 I=1,5
C
2345		DATA.DMBTU(I)=MBTUS(I)
C
C
411	CLOSE (55)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		subsection to read anval values
C
CC	DATA.TANK(1)=ANVAL(TNKS(1))
CC	DATA.TANK(2)=ANVAL(TNKS(2))
CC	DATA.TANK(3)=ANVAL(TNKS(3))
CC	DATA.TANK(4)=ANVAL(TNKS(4))
C
	K=0
	DO 71 M=1,7
C
	I=FILT1(M)/32+1
	J=MOD(FILT1(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
71	CONTINUE
C
	DATA.FILOP(1)=K
C
C
	K=0
	DO 72 M=1,10
C
	I=FILT2X(M)/32+1
	J=MOD(FILT2X(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
72	CONTINUE
C
	DATA.FILOP(2)=K
C
C
C
C
	K=0
	DO 73 M=1,6
C
	I=VAC1(M)/32+1
	J=MOD(VAC1(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
73	CONTINUE
C
	DATA.VAC(1)=K
C
C
	K=0
	DO 74 M=1,10
C
	I=VAC2(M)/32+1
	J=MOD(VAC2(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
74	CONTINUE
C
	DATA.VAC(2)=K
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		subsection to read hourly values
C
C
	READ (10,REC=694) A,B
	if (B .LE. 0) GO TO 7416
	DATA.TOT203(1)=A/B
	DATA.TOT203(2)=A/B
7416	READ (10,REC=680) A,B
	IF (B .LE. 0) GOTO 6544
	DATA.TOT203(3)=A/B
6544	DO 99 I=1,3
	READ (10,REC=GB(I))A,B
	DATA.PROD(I)=A
99	CONTINUE
	DO 100 I=1,3
	READ (10,REC=BZSP(I))A,B
	IF (B .LE. 0) GO TO 100
	DATA.BZ(I)=A/B
100	CONTINUE
	DO 101 I=1,3
	READ (10,REC=KESP(I))A,B
	IF (B .LE. 0) GO TO 101
	DATA.KE(I)=A/B
101	CONTINUE
	DO 102 I=1,3
	READ (10,REC=PHF(I))A,B
	IF (B .LE. 0) GO TO 102
	DATA.PRE(I)=A/B
102	CONTINUE
	DO 103 I=1,3
	READ (10,REC=PHF(I))A,B
	IF (B .LE. 0) GO TO 103
	DATA.PRE(I)=A/B
103	continue
C
	DO 104 I=1,3
	IF (UGE(I) .GT. 0) THEN
		READ (10,REC=UGE(I))A,B
	IF (B .LE. 0) GO TO 104
		DATA.UGR(I)=A/B
	ELSE
		DATA.UGR(I)=0
	END IF
	READ (10,REC=UGW(I))A,B
	IF (B .LE. 0) GO TO 104
	IF ((A/B) .GT. DATA.UGR(I)) DATA.UGR(I)=A/B
104	CONTINUE
C
	DO 105 I=1,3
	READ (10,REC=DD1(I))A,B
	IF (B .LE. 0) GO TO 105
	DATA.DD1(I)=A/B
105	CONTINUE
C
	DO 106 I=1,3
	IF (DD2(I) .LE. 0) GO TO 106
	READ (10,REC=DD2(I))A,B
	IF (B .LE. 0) GO TO 106
	DATA.DD2(I)=A/B
106	CONTINUE
C
	DO 107 I=1,3
	READ (10,REC=GSPD(I))A,B
	IF (B .LE. 0) GO TO 107
	DATA.GSPD(I)=A/B
107	CONTINUE
C	
	DO 108 I=1,3
	READ (10,REC=BED(I))A,B
	IF (B .LE. 0) GO TO 108
	DATA.BED(I)=A/B
108	CONTINUE
C	
	CLOSE (10)
C	
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		shift values
C
C
cccccccccccccccc
c
c 	remove step 2 reclaim  (per t. colarich, 23-jul-1990)
c
cc	DO 109 I=2,2
cc	READ (11,REC=RECL(I))A,B
cc109	DATA.RECI(I)=A
C
cc	DO 110 I=2,2
cc	READ (11,REC=TOPILE(I))A,B
cc110	DATA.RECO(I)=A
c
cccccccccccccccc
C
	DO 111 I=1,3
	READ (11,REC=PTNS(I))A,B
111	DATA.PTONS(I)=A
C
	DO 112 I=1,3
	READ (11,REC=BENT(I))A,B
	DATA.BENT(I)=A
C	IF (DATA.PTONS(I) .LE. 0) GO TO 112
C	DATA.BENT(I)=DATA.BENT(I)/DATA.PTONS(I)
112	CONTINUE
C
	DO 113 I=1,3
	READ (11,REC=GCF(I))A,B
113	DATA.GASCF(I)=A
C
	DO 114 I=1,3
	READ (11,REC=GH(I))A,B
	IF (A .GT. 7.99) A=8.00		!Round up grate hours
114	DATA.GRATEHR(I)=A
C
	DO 115 I=1,4
	READ (11,REC=BDH3(I))A,B
115	DATA.BALLHR(1)=DATA.BALLHR(1)+A
C
C
	DO 116 I=1,5
	READ (11,REC=BDH4(I))A,B
116	DATA.BALLHR(2)=DATA.BALLHR(2)+A
C
C
	DO 117 I=1,5
	READ (11,REC=BDH5(I))A,B
117	DATA.BALLHR(3)=DATA.BALLHR(3)+A
C
C
	DO 118 I=1,3
	READ (11,REC=WTNS(I))A,B
118	DATA.WOODT(I)=A/2000.
C
C
	CLOSE (11)
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		DAILY VALUES
	CLOSE (12)
C
	IF (JSHIFT .NE. 3) GO TO 499
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
499	OPEN (21,FILE='MET_P:SCREENX.DAT',FORM='UNFORMATTED',
	1	ACCESS='DIRECT',STATUS='UNKNOWN',RECL=2000,
	1	SHARED,USEROPEN=UFO_OPEN,ERR=844)
C
C
	READ (21,REC=1)DATF,IS,IH,SCREEN,COMP,CAB,SIL,FILT2,
	1			FILT3,BL2,BL3,FLUXG,FCA,FMG,FAL,FSI
C
C
C
	IF ((IS .EQ. 1).AND.(IH.EQ.1)) THEN
		READ (21,REC=2)DATF,IS,IH,SCREEN,COMP,CAB,SIL,FILT2,
	1			FILT3,BL2,BL3,FLUXG,FCA,FMG,FAL,FSI
C
	ELSE
C
		IF (IS .EQ. 1) THEN
			IH=1
C
		ELSE IF (IH .EQ. 2) THEN
			IH=1
C
		ELSE
			IH=2
			IS=IS-1
		END IF
C
	END IF
C
	DO 544 I=1,5
		SUMA(I)=0.
		SUMB(I)=0.
		DATA.BT(I)=0.
		DATA.AT(I)=0.
		DATA.Q(I)=0.
		DATA.CMP(I)=0.
		DATA.M200(I)=0.
544	CONTINUE
C
C
	DO 2020 I=1,5
	DO 2020 J=1,7
		SUMB(I)=SUMB(I)+SCREEN(J,IS,IH,I)
		SUMA(I)=SUMA(I)+SCREEN(J+7,IS,IH,I)
2020	CONTINUE
C
C
	DO 200 I=1,5
	DO 200 J=1,4
		DATA.BT(I)=DATA.BT(I)+SCREEN(J,IS,IH,I)
		DATA.AT(I)=DATA.AT(I)+SCREEN(J+7,IS,IH,I)
200	CONTINUE
C
C
	DO 203 I=1,5
	IF (SUMB(I) .LE. 0) GO TO 292
	DATA.BT(I)=DATA.BT(I)/SUMB(I)*100.
292	IF (SUMA(I) .LE. 0) GO TO 203
	DATA.AT(I)=DATA.AT(I)/SUMA(I)*100.
203	CONTINUE
C
	DO 201 I=1,5
		DATA.Q(I)=(DATA.BT(I)*DATA.AT(I))/100.
201	CONTINUE
C
	DO 202 I=1,5
		DATA.CMP(I)=COMP(1,IS,IH,I)
		DATA.M200(I)=COMP(2,IS,IH,I)
202	CONTINUE
C
	IF (IS .EQ. 1) THEN
C
		READ (21,REC=2)DATF,IS,IH,SCREEN,COMP,CAB,SIL,FILT2,
	1			FILT3,BL2,BL3,FLUXG,FCA,FMG,FAL,FSI
C
		IS=3
C
	ELSE
C
		IS=IS-1
C
	END IF
C
	CLOSE (21)
C
C		filter b/a and ratio
C
   		IF ((FAL(1,IS)+FILT2(1,IS)) .LE. 0) GO TO 509
	DATA.BTA(1)=(FCA(1,IS)+FMG(1,IS))/(FAL(1,IS)+FILT2(1,IS))
	DATA.BTA(2)=(FCA(1,IS)+FMG(1,IS))/(FAL(1,IS)+FILT2(1,IS))
509		IF ((FAL(2,IS)+FILT3(1,IS)) .LE. 0) GO TO 620
	DATA.BTA(3)=(FCA(2,IS)+FMG(2,IS))/(FAL(2,IS)+FILT3(1,IS))
C
C
620	IF ((FCA(1,IS).LE.0) .OR. (FMG(1,IS).LE.0)) GO TO 4039
		DATA.RATIO(1)=((FCA(1,IS)+FMG(1,IS))-.6)/.5377
		DATA.RATIO(1)=DATA.RATIO(1)/(100.-DATA.RATIO(1))
		DATA.RATIO(2)=DATA.RATIO(1)
4039	IF ((FCA(2,IS).LE.0) .OR. (FMG(2,IS).LE.0)) GO TO 844
		DATA.RATIO(3)=((FCA(2,IS)+FMG(2,IS))-.6)/.5377
		DATA.RATIO(3)=DATA.RATIO(3)/(100.-DATA.RATIO(3))
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
844	WAITX=0
C
C	LOOK FOR DATA LINKED FROM BMG
C
	DO 808 I=1,200
808		VL(I)=0.
C
C
91	OPEN   (UNIT=22,FILE='USER_D:[METREP.ASHIFT]SHIFDT.DAT',
	1	FORM='UNFORMATTED',
	1	STATUS='OLD',ERR=188)
C
C
	GO TO 27
C
C
C
188	WAITX=WAITX+1
	IF (WAITX .GT. 10) GO TO 56
C
	CALL LIB$WAIT (15.)
C
	GO TO 91
C
C
C
C
27	READ (22) VL
	CLOSE (22)
C
56	CALL LIB$DELETE_FILE ('USER_D:[METREP.ASHIFT]SHIFDT.DAT.*')
C
C
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	PUT AMI,BMI, AND BMH DATA INTO STRUCTURE
C
C
CC	DATA.TANK(5)=VL(2)
CC	DATA.TANK(6)=VL(3)
	DATA.PROD(4)=VL(17)
	DATA.PROD(5)=VL(18)
	DATA.FILOP(3)=VL(1)
	DATA.VAC(3)=VL(4)
	DATA.CSIO2(2)=VL(74)
	DATA.CSIO2(3)=VL(75)
	DATA.RECOV(2)=VL(76)
	DATA.RECOV(3)=VL(77)
	DATA.GRIND(2)=VL(78)
	DATA.GRIND(3)=VL(79)
	DATA.PTONS(4)=VL(49)
	DATA.PTONS(5)=VL(50)
	DATA.BENT(4)=VL(63)
	DATA.BENT(5)=VL(64)
	DATA.BZ(4)=VL(19)
	DATA.BZ(5)=VL(20)
	DATA.KE(4)=VL(21)
	DATA.KE(5)=VL(22)
	DATA.PRE(4)=VL(23)
	DATA.PRE(5)=VL(24)
	DATA.UGR(4)=VL(25)
	DATA.UGR(5)=VL(26)
	DATA.DD1(4)=VL(27)
	DATA.DD1(5)=VL(28)
	DATA.DD2(4)=VL(29)
	DATA.DD2(5)=VL(30)
	DATA.GSPD(4)=VL(31)
	DATA.GSPD(5)=VL(32)
	DATA.BED(4)=VL(33)
	DATA.BED(5)=VL(34)
	DATA.HITMP(4)=VL(35)
	DATA.HITMP(5)=VL(36)
	DATA.GRATEHR(4)=VL(51)
	DATA.GRATEHR(5)=VL(52)
	DATA.BALLHR(4)=VL(53)
	DATA.BALLHR(5)=VL(54)
	DATA.WOODT(4)=VL(57)
	DATA.WOODT(5)=VL(58)
	DATA.GASCF(4)=VL(55)
	DATA.GASCF(5)=VL(56)
	DATA.COALT(4)=VL(59)/2000.
	DATA.COALT(5)=VL(60)/2000.
	DATA.RECI(3)=VL(61)
	DATA.RECO(3)=VL(62)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	WRITE (75,REC=JSHIFT) DATA
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		COLLECT DATA FOR FOREMEN
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	  save data for each foreman
C
C
C
	OPEN   (UNIT=50,FILE='USER_D:[METREP.ASHIFT]FORFILE.DAT',
	1	STATUS='UNKNOWN',ORGANIZATION='INDEXED',ACCESS='KEYED',
	1	FORM='UNFORMATTED',RECL=256,KEY=(1:6:CHARACTER),
	1	ERR=1107)
C
	DO 588 I=1,12
		IF (MN(I) .EQ. DATA.DATES(4:6)) GO TO 578
588	CONTINUE
C
	GO TO 1107
C
C
578	LLL=0
C
	ATIM(1:11)=DATA.DATES//'-'//DATA.YR

C
	CALL SYS$BINTIM (ATIM,BTIM)
C
	WRITE (KY(3:4), '(I2)') I
	IF (I .LT. 10) KY(3:4)='0'//KY(4:4)
C
	KY=DATA.YR(3:4)//KY(3:4)//DATA.DATES(1:2)
C
C
C
	READ (50,KEY=KY,IOSTAT=M,ERR=373) FOR
C
C
C
373	IF (M .EQ. 52) THEN
		LLL=LLL+1
		IF (LLL .GT. 10) GO TO 1107
		CALL LIB$WAIT(2.)
		GO TO 578
	END IF
C
	IF ((M .EQ. 36) .OR. (M .EQ. 0)) THEN
		GO TO 1108
	ELSE
		GO TO 1107
	END IF
C
C
C
1108	IF (M .EQ. 36) THEN
C
		FOR=ZFOR	!zero out structure
C
	END IF
C
C
C	
	FOR.DATE=KY
C
C
C	L=the crew number of the foreman for this shift
C
CCCCCCCCCCCCCCCCCCCCCCC
	CALL LIB$DAY (NOFD,BTIM,)  !get day no. of passed time
C
C
	DO 44 I=1,4    	! get day no. of 4 starting dates
C
	CALL SYS$BINTIM (FORD(I),CTIM)  !convert sched. date to binary
C
44		CALL LIB$DAY (FNOFD(I),CTIM,)
C
C
	DO 45 I=1,4                	! calc shift no. of the day passed
C                                       ! to 'ADATE' for all 4 crews
C
	SS(I)=NOFD-FNOFD(I)+1  	!calc no. of days from base to now
C
	SS(I)=MOD(SS(I),28)             !get remainder after divide by 28
C
	IF (SS(I) .EQ. 0) SS(I)=28      !if remain.=0 then remain=28
C
	SS(I)=LIST(SS(I))               !get corresp. shift no. from 'list'
C
45	CONTINUE
C
C
	ICNT=0
	DO 46 I=1,4
46	IF (SS(I) .EQ. 0) ICNT=ICNT+1
C
C
	IF (ICNT .NE. 1) GO TO 1107
C
C
CCCCCCCCCCCCCCCCCCCCCCC
		DO 522 L=1,4
			IF (SS(L) .EQ. JSHIFT) GO TO 955
522		CONTINUE
		GO TO 1107
C			
C
C
955	DO 444 IS=1,2		! loop thru for both steps
C
		FOR.NAME(JSHIFT,IS)=FORM(L,IS)		! name	
C
C
444	CONTINUE
C
C
	 		! save material type
		FOR.FA(1,JSHIFT)='F'
		FOR.FA(2,JSHIFT)='F'
		FOR.FA(3,JSHIFT)='F'
		IF (DATA.PELTYP(1).NE. 0) THEN
			FOR.FA(1,JSHIFT)='A'
			FOR.FA(2,JSHIFT)='A'
			FOR.FA(3,JSHIFT)='A'
		END IF
C
		FOR.FA(4,JSHIFT)='F'
		FOR.FA(5,JSHIFT)='F'
		IF (DATA.PELTYP(4).NE. 0) THEN
			FOR.FA(4,JSHIFT)='A'
			FOR.FA(5,JSHIFT)='A'
		END IF
C
c
	DO 383 I=1,5
		FOR.TONS(I,JSHIFT)=DATA.PTONS(I)
		FOR.TIME(I,JSHIFT)=DATA.GRATEHR(I)
		FOR.MBTU(I,JSHIFT)=DATA.MBTU(I)
		IF (DATA.PTONS(I) .LE. 0) GO TO 383
		FOR.BENT(I,JSHIFT)=DATA.BENT(5)/DATA.PTONS(I)
383	CONTINUE
C
	IF (M .EQ. 36) WRITE (50,ERR=1107) FOR
	IF (M .EQ. 0) REWRITE (50,ERR=1107) FOR
C
	CLOSE (50)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
1107	CLOSE (75)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	send data to foremens office and step 2 control room (lta017:)
C
C
	STATUS=SYS$WAKE (,'AUTOSTART')
C
C
	GO TO 3000
C
C
CC412	XC=XC+1
CC	CALL LIB$WAIT(1.)
CC	IF (XC .GT. 60) STOP
CC	GO TO 543
C
3000	CALL  SYS$HIBER()	!wait for next time period
C
	GO TO 2500
	END
