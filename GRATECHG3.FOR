C
	PROGRAM 	GRATECHG3
C
	IMPLICIT NONE
C
	INTEGER*4	LINE,I,J,K,L,OUTPUTX,LEN
	INTEGER*4	UFO_OPEN
	CHARACTER*4	CLEAR/' [2J'/
	CHARACTER*3	HOME/' [H'/
	CHARACTER*3	CLEARX/' [J'/
	CHARACTER*8	HOMEX/' [12;12H'/
	REAL*4		SECONDS/2.0/,RESP
	CHARACTER*1	RESPONSE,OPT,FF
	CHARACTER*23	DATETIME
C
	INTEGER*4	CONTRL(2)
	REAL*4		PRGLSP(2),
	1		LVLPRN(2),
	1		LVOBAS(2),
	1		LVLOUT(2),
	1		SPDSET(2),
	1		SPDPRN(2),
	1		OUTBAS(2),
	1		OUTPUT(2),
	1		SPDO32(2),
	1		LTPH(2),
	1		LVSPI(2),
	1		LVSPD(2),
	1		LVSPP(2),
	1		SPOUTI(2),
	1		SPOUTD(2),
	1		SPOUTP(2),
	1		LVLHI(2),
	1		LVLLO(2),
	1		SPDHI(2),
	1		SPDLO(2),
	1		CNTLSP(2),
	1		CRTLSP(2),
	1		LVLPRO(2),
	1		SPDPRO(2),
	1		SPDS32(2),
	1		SPDN32(2),
	1		SPDL32(2),
	1		SPDB32(2),
	1		OUT32I(2),
	1		OUT32D(2),
	1		OUT32P(2),
	1		SP32LO(2),
	1		SP32HI(2)
C
	COMMON/GRATEFILE3/CONTRL,PRGLSP,LVLPRN,LVOBAS,
	1		 LVLOUT,SPDSET,SPDPRN,OUTBAS,
	1		 OUTPUT,SPDO32,LTPH,LVSPI,
	1		 LVSPD,LVSPP,SPOUTI,SPOUTD,
	1		 SPOUTP,LVLHI,LVLLO,SPDHI,
	1		 SPDLO,CNTLSP,CRTLSP,LVLPRO,
	1		 SPDPRO,SPDS32,SPDN32,SPDL32,
	1		 SPDB32,OUT32I,OUT32D,OUT32P,
	1		 SP32LO,SP32HI
C
	EXTERNAL	UFO_OPEN
C
	OPEN	(UNIT=6,FILE='SYS$COMMAND',STATUS='UNKNOWN')
C
	FF=CHAR(12)
	CLEAR(1:1)=CHAR(27)
	HOME(1:1)=CHAR(27)
	CLEARX(1:1)=CHAR(27)
	HOMEX(1:1)=CHAR(27)
C
5	CONTINUE
	WRITE	(6,10)CLEAR
10	FORMAT	(' ',A)
100	CONTINUE
	WRITE	(6,110)HOME
110	FORMAT	(' ',A)
115	CONTINUE
	DO 1000	I=1,2
		LINE=I+5
C
	WRITE	(6,120)LINE
120	FORMAT	(' GRATE & 32B LINE ',I1,'   INCR','  DERIV','   PROP',
	1				 '   HIGH','    LOW')
	WRITE	(6,200)LVSPI(I),LVSPD(I),LVSPP(I),LVLHI(I),LVLLO(I)
200	FORMAT	(' GRATE BED LEVEL   ',3F7.3,2F7.2)
	WRITE	(6,210)SPOUTI(I),SPOUTD(I),SPOUTP(I),SPDHI(I),SPDLO(I)
210	FORMAT	(' GRATE SPEED       ',3F7.3,2F7.2)
	WRITE	(6,220)OUT32I(I),OUT32D(I),OUT32P(I),SP32HI(I),SP32LO(I)
220	FORMAT	(' 032 BELT SPEED    ',3F7.3,2F7.2)
	WRITE	(6,250)
250	FORMAT(' .....................................................')
1000	CONTINUE
C
	IF (OPT .EQ. 'H')THEN
		CLOSE	(UNIT=6)
		OPEN	(UNIT=6,FILE='SYS$COMMAND',STATUS='UNKNOWN')
	END IF
C
275	CONTINUE
	WRITE	(6,276)HOMEX,CLEARX
276	FORMAT	(' ',A)
	WRITE	(6,300)
300	FORMAT	(' TYPE LINE NO. (6 OR 7)...(H FOR HARD COPY)'
	1	' OR PUSH RETURN TO QUIT')
	READ	(6,320)LEN,OPT
320	FORMAT	(Q,A)
	IF (LEN .EQ. 0)GOTO 9999
	IF (OPT .EQ. 'H')THEN
		CLOSE	(UNIT=6)
		OPEN	(UNIT=6,FILE='LTA071:',STATUS='UNKNOWN')
		CALL	LIB$DATE_TIME(DATETIME)
		WRITE	(6,321)FF,DATETIME
321		FORMAT	(A,A/)
		GOTO 115
	END IF
C
	DECODE (1,324,OPT)LINE
324	FORMAT	(I1)
	IF ((LINE .LT. 6).OR.(LINE .GT. 7)) GOTO 275
	LINE=LINE-5
325	CONTINUE
	WRITE	(6,326)HOMEX,CLEARX
326	FORMAT	(' ',A,A)
	WRITE	(6,340)
340	FORMAT	(' SELECT OUTPUT VARIABLE',/' 1 = LEVEL FEEDBACK',
	1				   /' 2 = GRATE SPEED',
	1			           /' 3 = 032 BELT SPEED')
	READ	(6,345)LEN,OUTPUTX
345	FORMAT	(Q,I1)
	IF (LEN .EQ. 0)GOTO 5
	IF ((OUTPUTX .LT. 1).OR.(OUTPUTX .GT. 3))GOTO 325
350	CONTINUE
	WRITE	(6,351)HOMEX,CLEARX
351	FORMAT	(' ',A,A)
	WRITE	(6,360)
360	FORMAT	(' SELECT RESPONSE',/' I = INCR',
	1		            /' D = DERIV',
	1		            /' P = PROP',
	1			    /' H = HILIM',
	1			    /' L = LOWLIM')
	READ	(6,375)LEN,RESPONSE
375	FORMAT	(Q,A)
	IF (LEN .EQ. 0)GOTO 325
	IF (RESPONSE .EQ. 'I')GOTO 400
	IF (RESPONSE .EQ. 'D')GOTO 400
	IF (RESPONSE .EQ. 'P')GOTO 400
	IF (RESPONSE .EQ. 'H')GOTO 400
	IF (RESPONSE .EQ. 'L')GOTO 400
	GOTO 350
400	CONTINUE
	WRITE	(6,401)HOMEX,CLEARX
401	FORMAT	(' ',A,A)
	WRITE	(6,425)
425	FORMAT	(' TYPE RESPONSE')
	READ	(6,450)LEN,RESP
450	FORMAT	(Q,F5.3)
	IF (LEN .EQ. 0)GOTO 350
	GOTO (500,
	1     600,
	1     700)OUTPUTX
500	CONTINUE
	IF (RESPONSE .EQ. 'I')LVSPI(LINE)=RESP
	IF (RESPONSE .EQ. 'D')LVSPD(LINE)=RESP
	IF (RESPONSE .EQ. 'P')LVSPP(LINE)=RESP
	IF (RESPONSE .EQ. 'H')LVLHI(LINE)=RESP
	IF (RESPONSE .EQ. 'L')LVLLO(LINE)=RESP
	GOTO 800	!SAVE CHANGE
600	CONTINUE
	IF (RESPONSE .EQ. 'I')SPOUTI(LINE)=RESP
	IF (RESPONSE .EQ. 'D')SPOUTD(LINE)=RESP
	IF (RESPONSE .EQ. 'P')SPOUTP(LINE)=RESP
	IF (RESPONSE .EQ. 'H')SPDHI(LINE)=RESP
	IF (RESPONSE .EQ. 'L')SPDLO(LINE)=RESP
	GOTO 800	!SAVE CHANGE
700	CONTINUE
	IF (RESPONSE .EQ. 'I')OUT32I(LINE)=RESP
	IF (RESPONSE .EQ. 'D')OUT32D(LINE)=RESP
	IF (RESPONSE .EQ. 'P')OUT32P(LINE)=RESP
	IF (RESPONSE .EQ. 'H')SP32HI(LINE)=RESP
	IF (RESPONSE .EQ. 'L')SP32LO(LINE)=RESP
	GOTO 800	!SAVE CHANGE
C
800	CONTINUE
C
	OPEN	(UNIT=1,FILE='CTL:GRATE3.DAT',STATUS='OLD',
	1	RECL=68,ACCESS='DIRECT',RECORDTYPE='FIXED',
	1	FORM='UNFORMATTED',SHARED,USEROPEN=UFO_OPEN)
C
	CRTLSP(1)=4.5
	CRTLSP(2)=4.5
C
	WRITE	(1,REC=1)CONTRL,PRGLSP,LVLPRN,LVOBAS,
	1		 LVLOUT,SPDSET,SPDPRN,OUTBAS,
	1		 OUTPUT,SPDO32,LTPH,LVSPI,
	1		 LVSPD,LVSPP,SPOUTI,SPOUTD,
	1		 SPOUTP,LVLHI,LVLLO,SPDHI,
	1		 SPDLO,CNTLSP,CRTLSP,LVLPRO,
	1		 SPDPRO,SPDS32,SPDN32,SPDL32,
	1		 SPDB32,OUT32I,OUT32D,OUT32P,
	1		 SP32LO,SP32HI
C
	CLOSE	(UNIT=1)
C
	GOTO 350
C
9999	CONTINUE
	CALL EXIT
C
	END

