	PROGRAM LINE6 
C
C	THIS PROGRAM COLLECTS THE DATA SPECIFIED BY THE 
C	LINE6X PROGRAM AND PUTS THE DATA IN THE LINE6.DAT FILE
C
	IMPLICIT NONE
C
	REAL*4		ANVAL(1000)
C
	REAL*8		ACCUMS(100),ACCUMX,
	1		OBS(100)
C
	INTEGER*4	POINT(100),
	1		INTVL,
	1		INTVLC,
	1		SCANC,
	1		RUNFLG,
	1		STRSTP
C
	INTEGER*4	I,J,K,M,ADDRESS(2),BIT
	INTEGER*4	UFO_OPEN
C
	CHARACTER*12	FILE/'GP:LINE6.DAT'/
	CHARACTER*13	FILEX/'GP:LINE6X.DAT'/
	CHARACTER*13	FILEP/'GP:LINE6P.DAT'/
	CHARACTER*23	STRTIME,STPTIME
	CHARACTER*8	TIME/'0 0:0:10'/
	CHARACTER*1	AVG
C
	EXTERNAL	UFO_OPEN
C
	COMMON/AG3_ANVALTBL/ANVAL
	COMMON/LINE6TBL/INTVL,INTVLC,AVG,
	1		SCANC,RUNFLG,STRSTP,ACCUMS,OBS,
	1		STRTIME,STPTIME
C
	OPEN (UNIT=2,FILE=FILEX,USEROPEN=UFO_OPEN,
	1		ACCESS='DIRECT',SHARED,RECL=417,
	1		STATUS='OLD',
	1		FORM='UNFORMATTED',RECORDTYPE='FIXED')
C
	READ	(2,REC=1)INTVL,INTVLC,AVG,
	1		SCANC,RUNFLG,STRSTP,ACCUMS,OBS,
	1		STRTIME,STPTIME
C
	CLOSE	(UNIT=2)
C
	OPEN (UNIT=1,FILE=FILEP,USEROPEN=UFO_OPEN,ACCESS='DIRECT',
	1	SHARED,RECL=100,STATUS='OLD',FORM='UNFORMATTED',
	1	RECORDTYPE='FIXED')
C
	READ	(1,REC=1)POINT	!READ IN POINTS LIST
C
	CLOSE	(UNIT=1)
C
	IF (RUNFLG .EQ. 0)GOTO 9999	!NO WORK ... SHUT OFF
C
	CALL	SYS$BINTIM(TIME,ADDRESS)
	CALL	SYS$SCHDWK(,,ADDRESS,ADDRESS)
C
250	CONTINUE
C
	IF(SCANC .EQ. 1500)THEN	!HAVE WE FILLED UP FILE
		RUNFLG=0
		CALL	LIB$DATE_TIME(STPTIME)
		GOTO 9999
	END IF
C
	IF (STRSTP .EQ. 1)THEN	!HAVE WE BEEN STOPPED
		RUNFLG=0	!CLEAR RUN FLAG
		STRSTP=0	!CLEAR STOP FLAG
		CALL	LIB$DATE_TIME(STPTIME)
		GOTO 9999	!GO SHUT OFF
	END IF
C
	IF (INTVLC .EQ. 0)THEN
		DO 300 I=1,100
			ACCUMS(I)=0	!SET UP FOR AVERAGING
			OBS(I)=0	!NEW TIME INTERVAL
300		CONTINUE
	END IF
C
	IF (AVG .EQ. 'Y')THEN
		DO 400 I=1,100
			IF (POINT(I) .EQ. 0)GOTO 400
C
			IF (POINT(I) .EQ. 577)THEN
				ACCUMX=ANVAL(POINT(I))
				ACCUMS(I)=ACCUMX
				OBS(I)=1
				GOTO 400
			END IF
C
				ACCUMX=ANVAL(POINT(I))
				ACCUMS(I)=ACCUMS(I)+ACCUMX
				OBS(I)=OBS(I)+1
400		CONTINUE
	END IF
C
	IF (AVG .EQ. 'N')THEN
		DO 500	I=1,100
			IF (POINT(I) .EQ. 0)GOTO 500
				ACCUMX=ANVAL(POINT(I))
				ACCUMS(I)=ACCUMX
				OBS(I)=1
C
500		CONTINUE
	END IF
C
	INTVLC=INTVLC+1
	IF (INTVLC .EQ. INTVL)THEN
		DO 600	I=1,100
			IF (POINT(I) .EQ. 0)GOTO 600
			IF (OBS(I) .EQ. 0)THEN
				ACCUMS(I)=0
			ELSE
				ACCUMS(I)=ACCUMS(I)/OBS(I)
			END IF
C
600		CONTINUE
		SCANC=SCANC+1	!BUMP POINTS COLLECTED COUNTER
		INTVLC=0	!RESET AVG INTERVAL COUNTER
C
		OPEN (UNIT=2,FILE=FILE,USEROPEN=UFO_OPEN,
	1		ACCESS='DIRECT',SHARED,RECL=200,
	1		STATUS='OLD',
	1		FORM='UNFORMATTED',RECORDTYPE='FIXED')
C
		WRITE	(2,REC=SCANC)ACCUMS	!WRITE TO FILE
C
		CLOSE	(UNIT=2)
C
	END IF
C
		OPEN (UNIT=2,FILE=FILEX,USEROPEN=UFO_OPEN,
	1		ACCESS='DIRECT',SHARED,RECL=417,
	1		STATUS='OLD',
	1		FORM='UNFORMATTED',RECORDTYPE='FIXED')
C
	WRITE	(2,REC=1)INTVL,INTVLC,AVG,
	1		SCANC,RUNFLG,STRSTP,ACCUMS,OBS,
	1		STRTIME,STPTIME
C
	CLOSE	(UNIT=2)
C
	CALL	SYS$HIBER()	!DELAY TILL NEXT RUN
	GOTO 	250
C
9999	CALL	EXIT
C
	END
