C
	PROGRAM	CYC_CLOCK	!CYCLONES CLOCK
C
C	LINK CYC_CLOCK,CYC_CLOCK/OPT
C
	IMPLICIT NONE
C
	INCLUDE	'($PRCDEF)'
C
	INTEGER*4	I,J,K,L,M,N
	INTEGER*4	UFO_OPEN
	INTEGER*4	CXSTS(100),BIT
	INTEGER*4	SECS,PM2230/81000/,PM2400/86400/
	INTEGER*4	CNTR,FIVMIN/300/,TEMP,ADRS(2)
	INTEGER*4	CX(96)/595,594,596,597,598,599,600,601,
	1		       602,603,604,605,606,607,608,609,
	1		       610,611,612,613,614,615,616,617,
	1		       618,619,620,621,622,623,624,625,
C
	1		       833,833,834,834,835,835,836,836,
	1		       837,837,838,838,839,839,840,840,
	1		       841,841,842,842,843,843,844,844,
	1		       845,845,846,846,847,847,848,848,
	1		       849,849,850,850,851,851,852,852,
	1		       853,853,855,855,857,857,859,859,
	1		       861,861,863,863,865,865,867,867,
	1		       869,869,871,871,873,873,875,875/
C
	INTEGER*4	CXO(18)/0,0,205,209,213,217,221,225,229,233,
	1			237,241,245,250,255,260,265,270/
C
	REAL*4		RSECS,OHRS(2)
C
	CHARACTER*8	TIM/'0 0:5:00'/
	CHARACTER*14	PRGNAM/'CYCLONES:CYCSZ'/
	CHARACTER*5	PRCNAM/'CYCSZ'/
	CHARACTER*12	ENUM
C
	COMMON/CONTACTSCNC/CXSTS
C
	EXTERNAL	UFO_OPEN
C
	RSECS=SECNDS(0.0)	!SECONDS SINCE MIDNIGHT
	SECS=RSECS		!CONVERT TO INTEGER
	TEMP=PM2230-SECS	!CALCULATE FIVE MINUTE SCANS TILL 10:30PM
	IF (TEMP .LT. 0)TEMP=TEMP+PM2400
	CNTR=TEMP/FIVMIN
C
	CALL	SYS$BINTIM(TIM,ADRS)
	CALL	SYS$SCHDWK(,,ADRS,ADRS)	!SCHEDULE 5 MIN WAKEUP
C
200	CONTINUE
C
	OPEN	(UNIT=1,FILE='CYCLONES:CYC_CLOCK.DAT',
	1	STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1	RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C

	DO 1000	I=1,96	!FOR EACH CYCLONE
C
		READ	(1,REC=I)ENUM,OHRS	!OPER TIME FOR THIS CLASSIFIER
C
		CALL	OTS$CVT_TI_L(ENUM(5:6),N,,%VAL(1))	!GET LINE #
C

		J=(CXO(N)/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(CXO(N),32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 0)GOTO 1000	!NO FEED IN CIRCUIT
C
		J=(CX(I)/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(CX(I),32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 1)THEN
			OHRS(1)=OHRS(1)+0.08331	!5 MIN OF OPER TIME
			WRITE	(1,REC=I)ENUM,OHRS	!CHANGE RECORD
		END IF
C
1000	CONTINUE
C
	CLOSE	(UNIT=1)
C

	CNTR=CNTR-1	!DECREMENT SCAN COUNTER
C
	IF (CNTR .LE. 0)THEN
		CNTR=288	!RESET SCAN COUNTER
C
		OPEN	(UNIT=1,FILE='CYCLONES:CYC_CLOCK.DAT',
	1		STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1		RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C
		DO 1200	I=1,96
			READ	(1,REC=I)ENUM,OHRS
			OHRS(2)=OHRS(1)  	!SAVE 24 HR RESULTS
			OHRS(1)=0		!ZERO NEW 24 HR PERIOD
			WRITE	(1,REC=I)ENUM,OHRS
1200		CONTINUE
C
		CLOSE	(UNIT=1)
C
		CALL	SYS$CREPRC(,PRGNAM,,,,,,PRCNAM,%VAL(4),,,
	1		%VAL(PRC$M_DETACH.OR.PRC$M_NOACNT))
C
	END IF
C
	CLOSE	(UNIT=1)
C
	CALL	SYS$HIBER()
	GOTO 200
C
	END
