CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C			CNCOMBRP.FOR
C
C			RJM 04-AUG-1988
C
C
C
C
C !!!!!!!!!!!!!!!!!  REMEMBER TO CHANGE PROGRAM OF SAME NAME !!!!!!!!!!!!!!
C !!!!!!!!!!!!!!!!!  IN [METREP.CGRAPHS] !!!!!!!!!!!!!!!!!!!!!!!!!!!!
C
C
C
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	PROGRAM CNCOMBRP
C
	IMPLICIT INTEGER (A-Z)
C
	EXTERNAL UFO_OPEN
C
C
	INCLUDE '($RMSDEF)'
C
C
C
	CHARACTER TWELV*1/12/,PUT*3,
	1	PO*4/'[?5i'/,POF*4/'[?4i'/,ES/27/,STR*5,STRL*5
C
C
C
	DOUBLE PRECISION MCB(150),OIB(150),MB(200),YB(200),MCA(150),OIA(150)
	1	,MA(200),YA(200),FTN,FTO,CBTUS,FBTUS,WBTUS,                
	1	TEMP,TEMP2,TRTNS,GR(51,3),HT,BT,SD,SM,SY,
	1	T11,T12,T13,T21,T22,T23,NLA,NLB,GR12,GR13,
	1	AO(150),AMC(150),AM(200),AY(200),FCD(4),FCM(4),FCY(4),
	1	FTD(4),FTM(4),FTY(4)
C
	INTEGER INTV(2),BD(2),YSTRDAY(2),BDS(2)
C
	LOGICAL M
C
	CHARACTER LEAD(2)*23/'USER_D:[METREP.AMCN]AMI',
	1	'USER_D:[METREP.BMCN]BMI'/ 
	1	,FNDSTRNG*80,FNM(5)*80,TOT(51)*24,D2*4
	1	,ST*7,STATE*6/'OLDNEW'/,TARCH*80,IN*1,TIM*8
	1	,AFILS(4)*23/'USER_D:[METREP.AMBA]AMB',
	1	'USER_D:[METREP.BMHA]BMH','USER_D:[METREP.AMBF]AMB',
	1	'USER_D:[METREP.BMHF]BMH'/,IND*11
C                                         
	CHARACTER AINTV*1 /'1'/,
	1	  DAT*4/'.DAT'/,
	1       AD*23, ARCHFNM*80, AYSTR*23 ,ATODAY*23,
	1	DAYFNM*80,MCCF*80,OICF*80
C                                 
	CHARACTER HEAD*49/'USS CORP. CONCENTRATOR PLANT METALLURGICAL REPORT'/
	1	,HEAD2*42/'DAY            MONTH             YEAR'/     
C
C
	DATA TOT/
	1	'RMF TONS-NATURAL        ','RMF TONS- DRY           ',
	1	'RMF AVG. LTPH           ','RMF % MAG FE            ',
	1	'CONCENTRATE TONS NAT.   ','CONCENTRATE TONS DRY    ',
	1	'CONCENTRATE NAT. LTPH   ','CONC % SIO2             ',
	1	'CONC % MAG FE           ','CONC % -270 MESH        ',
	1	'COARSE TAILS TONS-DRY   ','FINE TAILS TONS-DRY     ',
	1	'COARSE TAILS % MAG FE   ','FINE TAILS % MAG FE     ',
	1	'% RECOVERY NATURAL      ','% RECOVERY DRY          ',
	1	'MAG FE RECOVERY         ','SCHEDULED HOURS         ',
	1	'ACTUAL HOURS            ','% OPERATING TIME        ',
	1	'SCHEDULED MAINT. HOURS  ','% SCHED. MAINT.         ',
	1	'UNSCHEDULED MAINT. HRS  ','% UNSCHED. MAINT        ',
	1	'IMPOSED- AGGL REQUEST   ','IMPOSED- HI POWER       ',
	1	'IMPOSED- NO ORE         ','TOTAL IMPOSED HOURS     ',
	1	'% IMPOSED DELAY         ','OTHER DELAY HOURS       ',
	1	'% OTHER DELAY           ','AVAILABILITY HOURS      ',
	1	'% AVAILABILITY          ','KWH/TON-RMF             ',
	1	'RMF MOISTURE            ','NAT WT REC AFTER FLOT   ',
	1	'DRY WT REC AFTER FLOT   ','MAG FE REC AFTER FLOT   ',
	1	'FLOT CONC TO AGGLOM     ','ACID CONC TO AGGLOM     ',
	1       'TOTAL CONC TO AGGLOM    ','-3/4 INCH               ',
	1       '-1/2 INCH               ','RMF % MAG FE (COILS)    ',
	1       '                        ','                        ',
	1       '                        ','                        ',
	1       '                        ','                        ',
	1       '                        '/
C
C
	INTEGER BLN3(2),START3,THISDAY,ENDOFJUNE
C
C
	COMMON SD,SM,SY
C
C
	NLB=6           !NO. OF LINES BMI
C
C
C
C
	WRITE (6,*) ' '
	WRITE (6,*) ' '
	WRITE (6,*) ' CONCENTRATOR COMBINED MET REPORT'
	WRITE (6,*) ' '
	WRITE (6,*) ' '
C
C                                                          
	CALL TIME(TIM)
C
C
	CALL SYS$BINTIM (AINTV,INTV) !convert 24 hr interval to binary
C
	CALL SYS$GETTIM (BDS)      !present time
C
	PASS=0
C
3110	DO 49 JL=1,2
C
C                                 
	BD(1)=BDS(1)
	BD(2)=BDS(2)
C       
C
C
3000	CALL LIB$ADDX (BD,INTV,YSTRDAY,) !subtract 24 hrs from todays
C							date
C
C       
	CALL SYS$ASCTIM (,AYSTR,YSTRDAY,)     	!cnvt ystrdays time to ascii
C
		IF (AYSTR(1:1) .EQ. ' ') AYSTR(1:1)='0'
C                        
C
		ARCHFNM=LEAD(JL)//AYSTR(1:11)//DAT  
C                            
C                             
C                              08-JAN-1988
C	look for a file 'AMI or BMI//(yesterdays date).DAT.*'
C	
C       
	STATUS=LIB$FIND_FILE (ARCHFNM,FNDSTRNG,JK) 
C            
C
C
	IF (STATUS .EQ. RMS$_FNF)   THEN
C
		BD(1)=YSTRDAY(1)
		BD(2)=YSTRDAY(2)
C
		PASS=PASS+1
		IF (PASS .GE. 45) STOP 'ARCHIVE FILE NOT FOUND'
C
		GO TO 3000
	END IF
C
	WRITE (6,97)ARCHFNM(24:34)
C
97	FORMAT (' ',A45,'  FILE FOUND')
C
	FNM(JL)=ARCHFNM
C
	PASS=0
C              
49	CONTINUE
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	IF (FNM(1)(24:34) .NE. FNM(2)(24:34)) THEN
		WRITE (6,*) ' FILES ARE BEING UPDATED, PLEASE TRY LATER'
		STOP
	END IF
C
	WRITE (6,98)
98	FORMAT (/'0',' TYPE <RETURN> TO CONTINUE 
	1 SEARCH, ''U'' TO USE IT, "A" TO STOP,'/
	1 ' OR ENTER DESIRED DATE (ex: DD-MMM-YYYY)')
C
	READ (5,908)MT33,IND
908	FORMAT (Q,A11)
C
C
	IF (IND(1:1) .EQ. 'U' .OR. IND(1:1) .EQ. 'u')  THEN  
C
			GO TO 855
C
		ELSE IF (IND(1:1) .EQ. 'A') THEN
C
			STOP
C
		ELSE IF (MT33 .EQ. 0) THEN
C         
			BDS(1)=YSTRDAY(1)
			BDS(2)=YSTRDAY(2)
	                GO TO 3110    
C
	ELSE
C
		IF (MT33 .EQ. 10) THEN
			IND(1:11)='0'//IND(1:10)
		END IF
		AYSTR(1:11)=IND(1:11)
C
		CALL SYS$BINTIM (IND,YSTRDAY)                      
C
		DO 441 JJ=1,2
C
		ARCHFNM=LEAD(JJ)//AYSTR(1:11)//DAT
C
		FNM(JJ)=ARCHFNM
C                             
C		look for a file 'AMI(yesterdays date).DAT.*'
C	
C
		STATUS=LIB$FIND_FILE (ARCHFNM,FNDSTRNG,JK) 
C
C
C
		IF (STATUS .EQ. RMS$_FNF)   THEN
C
		WRITE (6,*) 'FILE FOR  ',AYSTR(1:11),'  DOES NOT EXIST'
		STOP
C
		END IF
C
C
441		CONTINUE
C
C
	WRITE (6,97)ARCHFNM(24:34)   !'file found' message
C
C
	END IF
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
855	IF (FNM(1)(24:34) .NE. FNM(2)(24:34)) THEN
434		WRITE (6,*) '########################################'
		WRITE (6,*) '########################################'
	WRITE (6,*) ' '
	WRITE (6,*) '  FILE DATES DO NOT MATCH, PLEASE TRY LATER! '
	WRITE (6,*) ' '
		WRITE (6,*) '########################################'
		WRITE (6,*) '########################################'
C
	STOP
C
	END IF
C
C
	CALL LIB$DAY (THISDAY,YSTRDAY,)
C
C
	CALL SYS$BINTIM ('10-JUN-1995',BLN3)
	CALL LIB$DAY (START3,BLN3,)
C
	CALL SYS$BINTIM ('30-JUN-1995',BLN3)
	CALL LIB$DAY (ENDOFJUNE,BLN3,)
C
	IF (THISDAY .GT. START3) THEN
		NLA=10    	!NO. OF LINES AMI
	ELSE
		NLA=9
	END IF
C
C
C                                  
	OPEN (UNIT=10,FILE=FNM(1),FORM='UNFORMATTED',STATUS='OLD'
	1	,SHARED,USEROPEN=UFO_OPEN)
C
C                            
	READ (10) MCA,OIA,MA,YA
C
	OPEN (UNIT=11,FILE=FNM(2),FORM='UNFORMATTED',STATUS='OLD'
	1	,SHARED,USEROPEN=UFO_OPEN)
C
C                            
	READ (11) MCB,OIB,MB,YB
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
	STR=ES//PO
	STRL=ES//POF
C
	WRITE (6,229)STR
229	FORMAT (' ',A)
C
C
C
C	bring in all agglom files
C
C
C
	DO 191 I=1,4
	FCD(I)=0
	FCM(I)=0
	FCY(I)=0
	FTD(I)=0
	FTM(I)=0
191	FTY(I)=0
C
C
C
	DO 880 I=1,4
C
	FNM(5)=AFILS(I)//FNM(1)(24:38)
C	        
	OPEN (UNIT=31,FILE=FNM(5),FORM='UNFORMATTED',STATUS='OLD'
	1	,SHARED,USEROPEN=UFO_OPEN,ERR=434)
C
C
	READ (31) AMC,AO,AM,AY
C
C
C
	IF ((I .EQ. 1) .OR. (I .EQ.3)) THEN
		FCD(I)=AO(47)
		FCM(I)=AM(147)       ! GET ACID,FLUX FILTER CAKE SIO2
		FCY(I)=AY(147)       ! FOR STEP 2 
C
		FTD(I)=AMC(5)+AMC(6)
		FTM(I)=AM(5)+AM(6)
		FTY(I)=AY(5)+AY(6)
C         
	ELSE IF ((I .EQ. 2) .OR. (I .EQ.4)) THEN
C		
		FCD(I)=AO(32)
		FCM(I)=AM(80)        ! GET ACID,FLUX FILTER CAKE SIO2
		FCY(I)=AY(80)        ! FOR STEP 3
C
		FTD(I)=AMC(3)+AMC(4)
		FTM(I)=AM(3)+AM(4)
		FTY(I)=AY(3)+AY(4)
C
	END IF
C
	CLOSE (31)
C
880	CONTINUE
C
	IF ((FTD(1)+FTD(2)) .LE. 0)  GO TO 321
	FCD(1)=(FCD(1)*FTD(1)+FCD(2)*FTD(2))/(FTD(1)+FTD(2))
321	IF ((FTD(3)+FTD(4)) .LE. 0)  GO TO 322
	FCD(2)=(FCD(3)*FTD(3)+FCD(4)*FTD(4))/(FTD(3)+FTD(4))
322	IF ((FTM(1)+FTM(2)) .LE. 0)  GO TO 323
	FCM(1)=(FCM(1)*FTM(1)+FCM(2)*FTM(2))/(FTM(1)+FTM(2))
323	IF ((FTM(3)+FTM(4)) .LE. 0)  GO TO 324
	FCM(2)=(FCM(3)*FTM(3)+FCM(4)*FTM(4))/(FTM(3)+FTM(4))
324	IF ((FTY(1)+FTY(2)) .LE. 0)  GO TO 325
	FCY(1)=(FCY(1)*FTY(1)+FCY(2)*FTY(2))/(FTY(1)+FTY(2))
325	IF ((FTY(3)+FTY(4)) .LE. 0)  GO TO 326
	FCY(2)=(FCY(3)*FTY(3)+FCY(4)*FTY(4))/(FTY(3)+FTY(4))
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                
326	NL=10	! NUMBER OF LINES
C                  
C
C
C
C
C		TONS
C
C
	DO 10 I=4,12
	T11=T11+MCA(I)
	T12=T12+MA(I)
	T13=T13+YA(I)
	GR12=GR12+MA(I)
	GR13=GR13+YA(I)
	GR(1,1)=GR(1,1)+MCA(I)
	GR(1,2)=GR(1,2)+MA(I+141)
10	GR(1,3)=GR(1,3)+YA(I+141)
C
	T11=T11+MCA(131)
	T12=T12+MA(187)
	T13=T13+YA(187)
	GR12=GR12+MA(187)
	GR13=GR13+YA(187)
	GR(1,1)=GR(1,1)+MCA(131)
	GR(1,2)=GR(1,2)+MA(144)
	GR(1,3)=GR(1,3)+YA(144)
C
C
C
C
C
C
C
	DO 11 I=1,6
	T21=T21+MCB(I)
	T22=T22+MB(I)
	T23=T23+YB(I)
	GR12=GR12+MB(I)
	GR13=GR13+YB(I)
	GR(1,1)=GR(1,1)+MCB(I)
	GR(1,2)=GR(1,2)+MB(I+75)
11	GR(1,3)=GR(1,3)+YB(I+75)
C
C
C		RMF H2O
C
	GR(35,1)=((T11*OIA(31))+(T21*OIB(19)))/GR(1,1)
	GR(35,2)=((T12*MA(140))+(T22*MB(74)))/GR12
	GR(35,3)=((T13*YA(140))+(T23*YB(74)))/GR13
C
C
C		DRY TONS
C
	DO 12 I=1,3
12	GR(2,I)=GR(1,I)*((100.-GR(35,I))/100.)
C
C
C		OP. HOURS
C
C
	DO 13 I=16,24
	GR(19,1)=GR(19,1)+MCA(I)
	GR(19,2)=GR(19,2)+MA(I)
13	GR(19,3)=GR(19,3)+YA(I)
C
	GR(19,1)=GR(19,1)+MCA(132)
	GR(19,2)=GR(19,2)+MA(188)
1	GR(19,3)=GR(19,3)+YA(188)
C
	DO 14 I=7,12
	GR(19,1)=GR(19,1)+MCB(I)
	GR(19,2)=GR(19,2)+MB(I)
14	GR(19,3)=GR(19,3)+YB(I)
C
C
C		TPH
C
	DO 15 I=1,3
	IF (GR(19,I) .LE. 0) GO TO 15
	GR(3,I)=GR(1,I)/GR(19,I)
15	CONTINUE
C
C
C		%RMF MAG FE
C
C	CALL AV(2,64,43,64,43,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),
C	1					GR12,GR13)
C	GR(4,1)=SD
C	GR(4,2)=SM
C	GR(4,3)=SY
C
C
	GR(4,1)=((T11*OIA(32))+(T21*OIB(20)))/GR(1,1)
	GR(4,2)=((T12*MA(141))+(T22*MB(75)))/GR12
	GR(4,3)=((T13*YA(141))+(T23*YB(75)))/GR13
C
C
C		%-3/4 INCH
C
	GR(42,1)=((T11*OIA(41))+(T21*OIB(21)))/GR(1,1)
	GR(42,2)=((T12*MA(185))+(T22*MB(84)))/GR12
	GR(42,3)=((T13*YA(185))+(T23*YB(84)))/GR13
C
C
C		%-1/2 INCH
C
	GR(43,1)=((T11*OIA(42))+(T21*OIB(22)))/GR(1,1)
	GR(43,2)=((T12*MA(186))+(T22*MB(85)))/GR12
	GR(43,3)=((T13*YA(186))+(T23*YB(85)))/GR13
C
C		CONC TONS
C
	DO 474 I=100,109
474	GR(5,1)=GR(5,1)+MCA(I)
C
	DO 475 I=50,55
475	GR(5,1)=GR(5,1)+MCB(I)
C
	DO 16 I=130,139
	GR(5,2)=GR(5,2)+MA(I)
16	GR(5,3)=GR(5,3)+YA(I)
C
	DO 17 I=67,72
	GR(5,2)=GR(5,2)+MB(I)
17	GR(5,3)=GR(5,3)+YB(I)
C
C
C		CONC DRY TONS
C
	GR(6,1)=GR(5,1)*.905
	GR(6,2)=GR(5,2)*.905
	GR(6,3)=GR(5,3)*.905
C
C
C		CONC LTPH
C
	GR(7,1)=GR(5,1)/GR(19,1)
	GR(7,2)=GR(5,2)/GR(19,2)
	GR(7,3)=GR(5,3)/GR(19,3)
C
C
C		SIO2
C
C
C
C
C		new sio2 calc
C
cccc	GR(8,1)=((T11*MCA(97))+(T21*MCB(49)))/GR(1,1)
cccc	GR(8,2)=((T12*MA(97))+(T22*MB(73)))/GR12
cccc	GR(8,3)=((T13*YA(97))+(T23*YB(73)))/GR13
C
	GR(8,1)=MCA(99)
	GR(8,2)=MA(99)
	GR(8,3)=YA(99)
C
C		CONC MAG FE
C
	GR(9,1)=((((MCA(99)*-.8435)+69.942)*T11)+(((MCB(56)*
	1	-.8435)+69.942)*T21))/GR(1,1)
	GR(9,2)=((((MA(99)*-.8435)+69.942)*T12)+(((MB(82)*
	1	-.8435)+69.942)*T22))/GR12
	GR(9,3)=((((YA(99)*-.8435)+69.942)*T13)+(((YB(82)*
	1	-.8435)+69.942)*T23))/GR13


C
C		-270 MESH
C
	CALL AV(2,87,31,87,31,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),
	1						GR12,GR13)
C
C
	GR(10,1)=SD
	GR(10,2)=SM
	GR(10,3)=SY
C
C
C		RMF % MAG FE (COILS)   (avg. by line rmf mag fe)
C
	CALL AV(2,63,43,63,43,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),
	1						GR12,GR13)
C
	GR(44,1)=SD
	GR(44,2)=SM
	GR(44,3)=SY
C
C
C
C		CT MAG FE
C
	CALL AV(1,3,1,100,49,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),
	1						GR12,GR13)
C
	GR(13,1)=SD
	GR(13,2)=SM
	GR(13,3)=SY
C
C
C		FT MAG FE
C
	CALL AV(1,15,7,112,55,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),
	1						GR12,GR13)
C
	GR(14,1)=SD
	GR(14,2)=SM
	GR(14,3)=SY
C
C
C		RECOV.- NAT & DRY
C
	DO 80 I=1,3
C
	GR(15,I)=GR(5,I)/GR(1,I)*100.
80	GR(16,I)=GR(6,I)/GR(2,I)*100.
C
C
C		MAG FE RECOV
C
CCC	DO 81 I=1,3
C
CCC81	GR(17,I)=GR(16,I)*GR(9,I)/GR(4,I)
C
C
	GR(17,1)=GR(16,1)*((MCA(99)*-.8435+69.942)/GR(4,1))
	GR(17,2)=GR(16,2)*((MA(99)*-.8435+69.942)/GR(4,2))
	GR(17,3)=GR(16,3)*((YA(99)*-.8435+69.942)/GR(4,3))
C
C
C		SCHED HOURS
C
	IF (THISDAY .LT. START3) THEN     ! its prior to 10-jun-95, line 3
C					     sched hrs= line 3 actual hours.
C
		GR(18,1)=(OIA(30)*9+mca(132))+ OIB(18)*NLB
		GR(18,2)=(MA(127)*9+MA(188))+ MB(66)*NLB
		GR(18,3)=(YA(127)*9+YA(188))+ YB(66)*NLB
C
C
C	   see if it's between 10-jun and 30-jun 1995
	ELSE IF (THISDAY .GE. START3 .AND. THISDAY .LE. ENDOFJUNE) THEN
C
		GR(18,1)=(OIA(30)*NLA)+OIB(18)*NLB
		GR(18,2)=1946.43+(NLA*MA(127))-2160.+MB(66)*NLB
		GR(18,3)=34555.02+NLA*YA(127)-38390.+YB(66)*NLB
C
C
c		! its after 30-jun-95, line 3 is running 24 hours a day
	ELSE IF (AYSTR(10:11) .EQ. '95') THEN	
C
		GR(18,1)=(OIA(30)*NLA)+ OIB(18)*NLB
		GR(18,2)=(MA(127)*NLA)+ MB(66)*NLB
		GR(18,3)=34555.02+NLA*YA(127)-38390.+ YB(66)*NLB
C
	ELSE
C
		GR(18,1)=(OIA(30)*NLA)+ OIB(18)*NLB
		GR(18,2)=(MA(127)*NLA)+ MB(66)*NLB
		GR(18,3)=YA(127)*NLA + YB(66)*NLB
C
	END IF
C
C
C
C		SCHED MAINT.
C
	GR(21,1)=OIA(25)+OIB(13)
	GR(21,2)=MA(122)+MB(61)
	GR(21,3)=YA(122)+YB(61)
C
C		UNSCHED MAINT
C
	GR(23,1)=OIA(26)+OIB(14)
	GR(23,2)=MA(123)+MB(62)
	GR(23,3)=YA(123)+YB(62)
C
C
C		%'S
C
	K=17
C
	DO 90 MJ=20,24,2
C
		K=K+2
C                    
	DO 90 I=1,3
C
90		GR(MJ,I)=GR(K,I)/GR(18,I)*100.
C
C                    
C		AGGL REQUEST
C
	GR(25,1)=OIA(27)+OIB(15)
	GR(25,2)=MA(124)+MB(63)
	GR(25,3)=YA(124)+YB(63)
C
C		HI POWER
C
 	GR(26,1)=OIA(28)+OIB(16)
	GR(26,2)=MA(125)+MB(64)
	GR(26,3)=YA(125)+YB(64)
C
C		NO ORE
C
	GR(27,1)=OIA(29)+OIB(17)
	GR(27,2)=MA(126)+MB(65)
	GR(27,3)=YA(126)+YB(65)
C
C
C		TOTAL IMPOSE
C
	DO 93 I=1,3
	DO 93 J=25,27
93		GR(28,I)=GR(28,I)+GR(J,I)
C
C		% IMPOSED
C
 	DO 94 I=1,3
94		GR(29,I)=GR(28,I)/GR(18,I)*100. 	
C
C
C		OTHER
C
	DO 95 I=1,3
		GR(30,I)=GR(18,I)-(GR(19,I)+GR(21,I)+GR(23,I)+GR(28,I))
95		GR(31,I)=GR(30,I)/GR(18,I)*100.
C
C
C		AVAILABILITY
C
	DO 951 I=1,3
C                                                                      
		GR(32,I)=GR(19,I)+GR(28,I)+GR(30,I)
951		GR(33,I)=GR(32,I)/GR(18,I)*100.
C
C
C		POWER CONSUMPTION
C	
	CALL AV(3,28,13,28,13,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),GR(1,2)
	1							 ,GR(1,3))
C
   	GR(34,1)=SD
	GR(34,2)=SM
	GR(34,3)=SY
C
C	
	CALL AV(3,40,19,40,19,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),GR(1,2)
	1							 ,GR(1,3))
C
   	GR(34,1)=GR(34,1)+SD
	GR(34,2)=GR(34,2)+SM
	GR(34,3)=GR(34,3)+SY
C
C	
	CALL AV(3,52,25,52,25,MCA,OIA,MA,YA,MCB,OIB,MB,YB,GR(1,1),GR(1,2)
	1							 ,GR(1,3))
C
   	GR(34,1)=GR(34,1)+SD
	GR(34,2)=GR(34,2)+SM
	GR(34,3)=GR(34,3)+SY
C
   	GR(34,1)=GR(34,1)+MCA(134)+MCA(135)+MCA(136)
	GR(34,2)=GR(34,2)+MA(190)+MA(191)+MA(192)
	GR(34,3)=GR(34,3)+YA(190)+YA(191)+YA(192)
C
	DO 105 I=1,3
C
105	GR(34,I)=GR(34,I)/GR(1,I)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		ADJ CONC TONS FROM AGGLOM
C
C
	GR(40,1)=OIA(37)+OIA(38)
	GR(40,2)=MA(175)+MA(176)
	GR(40,3)=YA(175)+YA(176)
C
	GR(39,1)=OIA(39)+OIA(40)
	GR(39,2)=MA(177)+MA(178)
	GR(39,3)=YA(177)+YA(178)
C
	DO 4881 I=1,3
4881	GR(41,I)=GR(39,I)+GR(40,I)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C                         
C
C		COARSE TAILS
C
	GR(11,1)=(GR(2,1)-(GR(41,1)*.905))*.4
	GR(11,2)=(GR(2,2)-(GR(41,2)*.905))*.4
	GR(11,3)=(GR(2,3)-(GR(41,3)*.905))*.4  
C
C
C		FINE TAILS
C
	GR(12,1)=(GR(2,1)-(GR(41,1)*.905))*.6
	GR(12,2)=(GR(2,2)-(GR(41,2)*.905))*.6
	GR(12,3)=(GR(2,3)-(GR(41,3)*.905))*.6
C
C
C
Ccccccccccccccccccccc
c
c	tot nat. & dry wt rec after flot
c
C
	DO 4882 I=1,3
	GR(36,I)=GR(41,I)/GR(1,I)*100.
4882	GR(37,I)=(GR(41,I)*.905)/GR(2,I)*100.
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	CONVERT FILTER CAKE SIO2 TO CONC MAG FE
C
C
	DO 499 I=1,2
C
	IF (I .LT. 2) THEN
C
		FCD(I)=FCD(I)*-0.8435+69.942
		FCM(I)=FCM(I)*-0.8435+69.942
		FCY(I)=FCY(I)*-0.8435+69.942
C
	ELSE
C
		FCD(I)=(FCD(I)+.28)*-0.8435+69.942
		FCM(I)=(FCM(I)+.28)*-0.8435+69.942
		FCY(I)=(FCY(I)+.28)*-0.8435+69.942
C
	END IF
C
499	CONTINUE
C
C
	GR(38,1)=100*
	1	(.905*(GR(40,1)*FCD(1)+GR(39,1)*FCD(2)))/(GR(2,1)*GR(4,1))
	GR(38,2)=100*
	1	(.905*(GR(40,2)*FCM(1)+GR(39,2)*FCM(2)))/(GR(2,2)*GR(4,2))
	GR(38,3)=100*
	1	(.905*(GR(40,3)*FCY(1)+GR(39,3)*FCY(2)))/(GR(2,3)*GR(4,3))
C
C
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		OUTPUT SECTION
C
C
C	
	WRITE (6,3311)AYSTR,HEAD,TIM,HEAD2
C
3311	FORMAT ('1',A11,10X,A/' ',A/' ',38X,A/)
C
C
	DO 6200 I=1,43
C
	IF (I .EQ. 2) THEN
C
		WRITE (6,233) TOT(35),GR(35,1),GR(35,2),GR(35,3)
C
	END IF
C
C
	IF (I .EQ. 5) THEN
		WRITE (6,233) TOT(44),GR(44,1),GR(44,2),GR(44,3)
	END IF
C
C
	IF (I .EQ. 35) GO TO 6200
C
	WRITE (6,233) TOT(I),GR(I,1),GR(I,2),GR(I,3)
C
233	FORMAT (' ',A,5X,3(F14.2,3X))
C 
C
C
6200	CONTINUE
C
C
C
C
C
	WRITE (6,229) STRL
C
CCCCCC   	WRITE (6,260)
CCCCCC260	FORMAT ('1')
C
	OPEN (UNIT=60,FILE='USER_D:[METREP]DGM_DATA.DAT',FORM=
	1 'UNFORMATTED',RECL=16,STATUS='UNKNOWN',ACCESS='APPEND')
C
C
	WRITE (60) AYSTR(1:11),GR(1,1),GR(5,1),GR(4,1),GR(10,1),
	1		GR(15,1),GR(8,1)
	CLOSE (60) 
 	STOP
	END
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C                
C  	AV SUBROUTINE
C
C	IF=1 OIC, 2 MCC, 3 SUMMATION USING MCC
C	NA=AMI STARTING FILE LOC, DAILY 
C       NB=BMI STARTING FILE LOC, DAILY
C	LA=STARTING MONTH LOC, BOTH STEPS
C	LB=STARTING YEAR LOC, BOTH STEPS
C	DYT=TOTAL DAILY TONS
C	MOT=TOTAL MONTH TONS
C	YET=TOTAL YEAR TONS
C
C
C	RESULTS ARE RETURNED IN COMMON SD,SM,SY 
C
C
	SUBROUTINE AV(IF,NA,NB,LA,LB,MCA,OIA,MA,YA,MCB,OIB,MB,YB,DYT,MOT,YET)
C
	DOUBLE PRECISION MCB(150),OIB(150),MB(200),YB(200),MCA(150),OIA(150)
	1		,MA(200),YA(200),DYT,MOT,YET,SD,SM,SY
C
	COMMON SD,SM,SY
C
	SD=0
	SM=0     
	SY=0
C
	IF (IF .EQ. 2) GO TO 40		!IF=2 MEANS USE MCC FILE
	IF (IF .EQ. 3) GO TO 4000
C
	J=3
	DO 20 I=NA,NA+9            
C
		IF (J .EQ. 3) THEN
			SD=SD+(OIA(I)*MCA(131))
C
			J=J+1
		ELSE
			SD=SD+(OIA(I)*MCA(J))
C
			J=J+1
C
		END IF
C
20	CONTINUE
C
C
	J=1
	DO 21 I=NB,NB+5
C
		SD=SD+(OIB(I)*MCB(J))
C
		J=J+1
C
21	CONTINUE
C
C                
	IF (DYT .GT. 0) THEN
C
		SD=SD/DYT
C
	ELSE
C
		SD=0
C                
	END IF
C
C
	GO TO 400
C
C
C
C
C
40	J=3
	DO 120 I=NA,NA+9
C
		IF (J .EQ. 3) THEN
			SD=SD+(MCA(I)*MCA(131))
C
			J=J+1
		ELSE
			SD=SD+(MCA(I)*MCA(J))
C
			J=J+1
		END IF
C
120	CONTINUE
C
C
	J=1
	DO 121 I=NB,NB+5
C
		SD=SD+(MCB(I)*MCB(J))
C
		J=J+1
C
121	CONTINUE
C
C
	IF (DYT .GT. 0) THEN
C
		SD=SD/DYT
C
	ELSE
C
		SD=0    
C
	END IF
C
C
C
400	J=3
C
	DO 200 I=LA,LA+9
C
		IF (J .EQ. 3) THEN
			SM=SM+(MA(I)*MA(187))
C
			J=J+1
		ELSE
			SM=SM+(MA(I)*MA(J))
C
			J=J+1
		END IF
200	CONTINUE
C
C
	J=1
C
	DO 201 I=LB,LB+5
C
		SM=SM+(MB(I)*MB(J))
C
201	J=J+1
C
C
	IF (SM .GT. 0) THEN
C
		SM=SM/MOT
C
	ELSE
C
		SM=0
C
	END IF
C
C
	J=3
C
	DO 210 I=LA,LA+9
C
		IF (J .EQ. 3) THEN
			SY=SY+(YA(I)*YA(187))
C
			J=J+1
		ELSE
			SY=SY+(YA(I)*YA(J))
C
			J=J+1
		END IF
210	CONTINUE
C
C
	J=1
C
	DO 211 I=LB,LB+5
C
		SY=SY+(YB(I)*YB(J))
C
211	J=J+1
C
C
	IF (SY .GT. 0) THEN
C
		SY=SY/YET
C
	ELSE
C
		SY=0
C
	END IF
C
C
C
	RETURN
C
4000	DO 300 I=NA,NA+8
C
300		SD=SD+MCA(I)
C
C
	DO 301 I=NB,NB+5
C
301		SD=SD+MCB(I)
C
C
C
	DO 302 I=LA,LA+8
C
		SM=SM+MA(I)
302		SY=SY+YA(I)
C
C
	DO 303 I=LB,LB+5
		SM=SM+MB(I)
303		SY=SY+YB(I)
C
C
	RETURN
	END
