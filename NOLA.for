C
	PROGRAM		NOLA
C
C	PROGRAM PUTS EACH NEW NOLA SAMPLE FROM THE STEP2 AND STEP3 NOLA 
C	INTO A FILE FOR LATER AUDITING.  THE PROGRAM RUNS EVERY 
C	10 SECONDS
C
C	LINK NOLA,NOLA/OPT
C
	IMPLICIT NONE
C
	REAL*4		ANVAL(1900)
	REAL*4		OLDTIM(30),SOLX,SIO2X
C
	INTEGER*4	SIO2(30)/1215,1216,1217,1218,1219,
	1			 1220,1221,1222,1223,1224,
	1			 1225,1226,1227,1228,1229,
	1			 1260,1261,1262,1263,1264,
	1			 1265,1266,1267,1268,1269,
	1			 1270,1271,1272,1273,1274/
	INTEGER*4	SOLS(30)/1230,1231,1232,1233,1234,
	1			 1235,1236,1237,1238,1239,
	1			 1240,1241,1242,1243,1244,
	1			 1275,1276,1277,1278,1279,
	1			 1280,1281,1282,1283,1284,
	1			 1285,1286,1287,1288,1289/
	INTEGER*4	TIMEX(30)/1245,1246,1247,1248,1249,
	1			  1250,1251,1252,1253,1254,
	1			  1255,1256,1257,1258,1259,
	1			  1290,1291,1292,1293,1294,
	1			  1295,1296,1297,1298,1299,
	1			  1300,1301,1302,1303,1304/
	INTEGER*4	SFLAG,MM,DD,YY,ADDRESS(2),TM
	INTEGER*4	I,J,K,L,M,N
	INTEGER*4	VAXTM,HRX,MNX,DIFF,FLAG,UFO_OPEN
C
	CHARACTER*4	LINE
	CHARACTER*23	DT
	CHARACTER*8	TIME/'0 0:0:10'/	!PROGRAM RUN FREQUENCY
	CHARACTER*13	FILES(2)/'ANA:NOLA2.DAT',
	1			 'ANA:NOLA3.DAT'/
	CHARACTER*4	LINEX(30)/'S2  ','S3  ','FB1 ','FB2 ','FB3 ',
	1			  'FB4 ','RGC ','FF  ','5TF ','FBC ',
	1			  'L9  ','L10 ','L11 ','L12 ','5T  ',
	1			  'S2  ','S3  ','FB1 ','FB2 ','FB3 ',
	1			  'FB4 ','RGC ','FF  ','PFF ','L14 ',
	1			  'L15 ','L16 ','L17 ','L18 ','34T '/
C
	COMMON/CNC_ANVALTBL/ANVAL	!ANVAL TABLE
C
	EXTERNAL	UFO_OPEN
C
	SFLAG=0		!INDICATE NEW START
C
	DO 100	I=1,30
C
		OLDTIM(I)=ANVAL(TIMEX(I))	!LOAD UP SAMPLE TIMES
C
100	CONTINUE
C
	CALL	SYS$BINTIM(TIME,ADDRESS)	!CONVERT ASCII TIME TO BINARY
	CALL	SYS$SCHDWK(,,ADDRESS,ADDRESS)	!PUT PROG ON 10 SEC SCHED
C
200	CONTINUE
C
	IF (SFLAG .EQ. 0)GOTO 5000	!GO WAIT ON FIRST PASS
C
	CALL	LIB$DATE_TIME(DT)
C
	CALL	OTS$CVT_TI_L(DT(1:2),DD,,%VAL(1))	!DAY
	CALL	OTS$CVT_TI_L(DT(8:11),YY,,%VAL(1))	!YY
	CALL	OTS$CVT_TI_L(DT(13:14),HRX,,%VAL(1))	!HOUR
	CALL	OTS$CVT_TI_L(DT(16:17),MNX,,%VAL(1))	!MINUTES
C
	VAXTM=(HRX*100)+MNX	!CALCULATE VAX MILITARY TIME
C
	IF (DT(4:6) .EQ. 'JAN')MM=1
	IF (DT(4:6) .EQ. 'FEB')MM=2
	IF (DT(4:6) .EQ. 'MAR')MM=3
	IF (DT(4:6) .EQ. 'APR')MM=4
	IF (DT(4:6) .EQ. 'MAY')MM=5
	IF (DT(4:6) .EQ. 'JUN')MM=6
	IF (DT(4:6) .EQ. 'JUL')MM=7
	IF (DT(4:6) .EQ. 'AUG')MM=8
	IF (DT(4:6) .EQ. 'SEP')MM=9
	IF (DT(4:6) .EQ. 'OCT')MM=10
	IF (DT(4:6) .EQ. 'NOV')MM=11
	IF (DT(4:6) .EQ. 'DEC')MM=12
C
	DO 1000	I=1,30	!PROCESS 30 LINES
		IF (OLDTIM(I) .EQ. ANVAL(TIMEX(I)))THEN
			GOTO 1000	!NO NEW SAMPLE
		ELSE
			TM=ANVAL(TIMEX(I))	!NEW SAMPLE TIME
			OLDTIM(I)=ANVAL(TIMEX(I))	!CHANGE TIME TABLE
			SIO2X=ANVAL(SIO2(I))	!NOLA SIZE
			SOLX=ANVAL(SOLS(I))	!NOLA SOLIDS
			J=1			!ASSUME STEP 2 NOLA
			IF (I .GE. 15)J=2	!MUST BE STEP 3 PSM
C
			OPEN	(UNIT=1,FILE=FILES(J),ACCESS='APPEND',
	1			RECORDTYPE='FIXED',RECL=8,SHARED,
	1			FORM='UNFORMATTED',STATUS='OLD',
	1			USEROPEN=UFO_OPEN)
C
				LINE=LINEX(I)	!INDICATE LINE NUMBER
C
				DIFF=TM-VAXTM	!IF TIMES ARE TOO FAR APART
				IF (ABS(DIFF) .GT. 100)TM=VAXTM !USE VAX TIME
C
				WRITE	(1)LINE,SIO2X,SOLX,TM,MM,DD,YY,FLAG
C
				CLOSE	(UNIT=1)
C
			END IF
C
1000	CONTINUE
C
5000	CONTINUE
C
	CALL	SYS$HIBER() 	!DELAY TILL NEXT TURN ON
	SFLAG=1			!INDICATE FIRST RUN COMPLETE
	GOTO 200
C
	END
