CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		SHIFTGET.FOR
C
C		RJM 30-JAN-1990
C
c   !!!!!!! make sure you FORTRAN7 sag3
C
C	LINK Sag3,D_I:AGD/OPT,AGDAG3/OPT,AGDCNC/OPT
C
C
C	HEY BOB!  REMEMBER THAT BOTH THIS PROGRAM AND 'AUTOSTART' HAVE
C	TO BE START FROM THE SAME PROCESS OR SYS$WAKE WILL NOT WORK!!!
C
C	03-APR-92  added code to write shift mine indicated sio2 to the
C	file 'HALFSIL.DAT'.
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	
	IMPLICIT INTEGER (A-Z)      
C
	EXTERNAL UFO_OPEN
C
	INCLUDE '($PRCDEF)'
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
	INTEGER FLAG/64/
C
C
C
C	LIST OF FOREMEN
C
C
	CHARACTER FORM(4,2)*10
	1	/'KOSKI     ','WILEN     ','MOE       ','BELLEVILLE',
	1	'DOWNING   ','ERICKSON  ','MOYLE     ','PULIS     '/,
C
	1	KY*6,
	1 MN(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL','AUG',
	1 	   'SEP','OCT','NOV','DEC'/
C
C
C
C
	CHARACTER ADATE*11,HSKEY*4,DATEX*12,ASCSH,ADOLD*11
	REAL VALU(24)
	INTEGER SS(4),NOFD,FNOFD(4),CTIM(2),B1(2),BBD(2)
	INTEGER*2 NUM(7)
	INTEGER LIST(28)
	1	/1,1,1,1,1,1,1,0,0,0,0,3,3,3,3,3,3,3,0,2,2,2,2,2,2,2,0,0/
C
	CHARACTER*11   			                         
	1	FORD(4)/
	1	'11-MAY-1990',  	! #1  date that each of the four 
	2	'25-MAY-1990',      	! #2  crews start their midnight
	3	'04-MAY-1990',      	! #3   shift (shift 1)
	4	'18-MAY-1990'/          ! #4
C
C

CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	INTEGER BTIM(2)
C
	CHARACTER MHR*2,MINIT*2,TT*7,DAY1*1/'1'/,TTIME*16,ASHIFT*4,SINP,
	1	DATTIM*23,ATIM*11,KD*8
C
C
	REAL PA,PC,PM,AEF(4)
C
	INTEGER DATF(2),IS,IH
C
 	DOUBLE PRECISION CT(18),FT(18),SCREEN(14,3,2,5),COMP(2,3,2,5),
	1  CAB(2,3,5),SIL(3,5),FILT2(5,3),BL2,FILT3(5,3),BL3,TOTAL,
	1  H2O,RMF,FTMF,BOIC(150),HOIC(150),CX(5),MX(5),AX(5),SX(5),
	1  FLUXG,P34,P12,FCA(2,3),FMG(2,3),FAL(2,3),FSI(2,3),
	1  SUMB(5),SUMA(5),SCWT(3,2,5)
C
C
C
C
C
	STRUCTURE /FOREMAN/
C
		CHARACTER DATE*6        ! KEY 0  DATE (YYMMDD)
		CHARACTER  NAME(3,2)*10	! names by shift
		REAL TONS(5,3)          ! pellet tons
		REAL TIME(5,3)          ! grate hours
		CHARACTER FA(5,3)	! F=FLUX, A=ACID
		REAL MBTU(5,3)          ! btus/ton
		REAL BENT(5,3)          ! bent. lbs/ton
C
		REAL BT(5,3)		! before tumble +1/4
		REAL AT(5,3)		! after tumble +1/4
		REAL COMP(5,3)          ! compression
		REAL PBA(5,3)           ! filter b/a
		REAL PSIL(5,3)		! non-existent
		REAL FCR(2,3)           ! filter cake ratio
C
	END STRUCTURE
C
	RECORD /FOREMAN/ FOR,ZFOR
C
C
C
	STRUCTURE /SHIFT/
C
C
	CHARACTER*6 DATES
	INTEGER SHIFT
	INTEGER TANK(6)
	CHARACTER BINS(5)*3
	REAL    PROD(5)
	INTEGER FILOP(3)
	INTEGER FILAV(3)
	INTEGER	VAC(3)
	REAL TRIPH20(3),FILTR(3),TOT203(3),CSIO2(3),RECOV(3),GRIND(3),
	1	BTA(3),RATIO(3),RECI(3),RECO(3),GRATEHR(5),BALLHR(5),
	1	WOODT(5),COALT(5),GASCF(5),PELTYP(5),RECBAL(5),
	1	FORECAST(2),ACTUAL(2),T42
C
	REAL PTONS(5),BENT(5),MBTU(5),BT(5),AT(5),Q(5),CMP(5),M200(5),
	1	BZ(5),KE(5),PRE(5),UGR(5),DD1(5),DD2(5),GSPD(5),BED(5),
	1	HITMP(5),MICRO(5)
C
	CHARACTER EQUIP(5,5)*13,
	1	STOP(5,5)*5,
	1	START(5,5)*5,
cccccccc	1	MSG(5,5)*40/25*' '/
	1	MSG(5,5)*40
C
	CHARACTER  MESSAGE(5)*80,SLOP*1482
C
	REAL FOTANK2
	REAL DDPD(5)
	REAL DDP(5)
	REAL FUELOIL(5)
	REAL FOTANK
C
	REAL DMBTU(5)
C
	CHARACTER YR*4
	REAL T37(5)
C
	REAL NOX(5)
C
	END STRUCTURE
C
C
C
	RECORD /SHIFT/ DATA
C
C
C
C
	CHARACTER DX*12,AJ
C
	REAL A,B
C
	DOUBLE PRECISION X(91),VL(200) 
C
	INTEGER PTRH(30),BD(2),RTIM(2),INTV(2),YSTRDAY(2)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		IMMEDIATE analog @ digital pt nos.
	INTEGER
	1	TNKS(4)		/14,28,37,708/,
	1	FILT1(7)	/76,77,78,79,223,200,201/,
	1	FILT2X(10)	/763,764,765,766,767,
	1			 768,769,770,771,772/,
	1	FILT3X(12)	/214,215,218,219,222,224,225,227,
	1			 229,232,234,236/,
	1	VAC1(6)		/33,34,35,37,38,217/,
	1	VAC2(10)	/712,713,714,715,716,717,718,719,
	1			 720,721/,
	1	VAC3(12)		/237,238,239,240,241,242,243,244,245,
	1			 246,247,248/,
	1	CSIL(2)		/1196,1197/,
	1	CREC(3)         /1663,1664,1665/,
	1	CGR(3)		/1677,1678,1679/
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		HOURLY ANALOG VALUES
C
	INTEGER
	1	TOT20312/694/, TOT2033/680/,
	1	BZSP(5)/891,666,667,566,567/,
	1	KESP(5)/890,578,612,568,569/,
	1	PHF(5)/893,663,617,570,571/,
	1	UGE(5)/0,584,616,560,561/, UGW(5)/887,580,614,554,555/,
	1	DD1(5)/733,123,240,86,255/, DD2(5)/0,63,179,148,317/,
	1	GSPD(5)/745,75,191,82,251/, BED(5)/886,575,609,550,551/
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		SHIFT ANALOG VALUES
C
	INTEGER
	1	RECL(2)/490,536/, TOPILE(2)/492,504/,
	1	PTNS(5)/867,339,340,564,565/,
	1	BENT(5)/876,362,363,803,804/,
	1	BZTEMP(5)/824,92,208,171,290/,
	1	KESET(5)/890,578,612,1,1/,
	1	GH(5)/1063,1001,1002,858,859/,
	1	BDH3(4)/1064,1065,1066,1067/,
	1	BDH4(5)/1003,1004,1005,1006,1007/,
	1	BDH5(5)/1008,1009,1010,1011,1012/,
	1	BDH6/839/,BDH7/840/,
	1	GCF(5)/1070,1051,1052,862,863/,
	1	WTNS(5)/1071,1047,1048,911,912/,
C		1	GB(5)/870,337,338,805,806/,
	1	GB(5)/987,988,989,644,645/,
	1	TONS37(5)/985,977,982,639,632/	
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
	CHARACTER TIMBUF*23
C
C
C
	CHARACTER ASTIM*14 /'-- 06:34:00.00'/, AINTV*7 /'0 08:00'/,
	1	FN*21 /'USER_D:[METREP]AMBMCC'/,  DAT*4/'.DAT'/,
	1       AD*23, FNM*33, AYSTR*23 ,FNDSTRNG*33
C
	REAL ANVAL(1200),MBTUS(5),ANVALC(1900),ANVAL3(1000)
	INTEGER CXSTS(100),DATP(2),CXSTS3(100)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
c
	structure /bozo2/
c
		character*4	key		! yymm	(primary key)
		real		msil(3,31)	! mine ind. sio2 by shift,day
		real		cr12(3,31)	! crusher +1/2 by shift,day
		real 		flfr(3,31)	! flf davis tube recovery
		real		flfs(3,31)	! flf davis tube sio2
		real		fls(3,31)	! flf sio2
		real		flts(3,31)	! flot tails sio2
		real		aeff(4,3,31)	! amine efficiency by cell
c
c
	end structure
c
	record /bozo2/ hsd
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
	COMMON /CONTACTS/CXSTS,/ANVALTBL/ANVAL
	COMMON /CONTACTSAG3/CXSTS3,/AG3_ANVALTBL/ANVAL3
C
	COMMON /CNC_ANVALTBL/ANVALC
C
	CALL SYS$BINTIM (DAY1,B1)
	CALL SYS$GETTIM (BD)
	CALL SYS$ASCTIM (,AD,,)	!get current date-time in ascii
C
C
C	set time to next shift in case of restart
C
	IF (AD(13:17) .GT. '22:50') THEN
		AD(13:14)='06'
	ELSE IF (AD(13:17) .GT. '14:50') THEN
		AD(13:14)='22'
	ELSE IF (AD(13:17) .GT. '06:50') THEN
		AD(13:14)='14'
	ELSE
		AD(13:14)='06'
	END IF
C
	ASTIM=ASTIM(1:3)//AD(13:14)//ASTIM(6:14)
C
	CALL SYS$BINTIM (ASTIM,RTIM) !convert XX:31 time to binary
C
	CALL SYS$BINTIM (AINTV,INTV) !convert 8 hr interval to binary
C
	CALL SYS$SCHDWK (,,RTIM,INTV) !sched. a wakeup at 22:31,6:31,14:31
C
C	
C
2500	CALL SYS$GETTIM (BD)
	CALL SYS$ASCTIM (,AD,,)	!get current date-time in ascii
C
C
C
	IF (AD(1:1) .EQ. ' ') AD(1:1)='0'
C
C
	IF (AD(13:14) .EQ. '22') THEN
		JSHIFT=3
	ELSE IF (AD(13:14) .EQ. '06') THEN
		JSHIFT=1
	ELSE IF (AD(13:14) .EQ. '14') THEN
		JSHIFT=2
	ELSE
		GO TO 3000
	END IF
C
C
C
C
C
4661	OPEN (UNIT=10,FILE='LOGS:HOUR.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=11,FILE='LOGS:SHIFT.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=12,FILE='LOGS:DAY.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
C
C
	OPEN (UNIT=40,FILE='LOGS:AG3_HOUR.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=41,FILE='LOGS:AG3_SHIFT.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
	OPEN (UNIT=42,FILE='LOGS:AG3_DAY.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=3000)	
C
C
C
	LCNT=0
1788	OPEN (75,FILE='MET_P:AGSHIFT.DAT',FORM='UNFORMATTED',
	1	ACCESS='DIRECT',STATUS='UNKNOWN',RECL=2048,ERR=88)
C
C
	GO TO 2540
C
C
C
88		LCNT=LCNT+1
C
		CALL LIB$WAIT (10.)
C
C
		GO TO 1788
C
C
2540	READ (75,REC=JSHIFT)DATA
C
C
	DATA.SHIFT=JSHIFT
	DATA.DATES=AD(1:6)
	DATA.YR=AD(8:11)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C		BTUS (FROM WJB)
C
	IM=0
C
C
9011	OPEN (UNIT=55,FILE='LOGS:MBTUS.DAT',
	1	STATUS='OLD',RECL=8,
	1	FORM='UNFORMATTED',RECORDTYPE='FIXED',
	1	ACCESS='DIRECT',ERR=996,USEROPEN=UFO_OPEN,SHARED)
C
	READ (55,REC=1,ERR=411)DATEX,MBTUS
C
C
	WRITE (AJ,'(I1)')JSHIFT
C
	IF (DATEX(12:12) .NE. AJ) THEN
C
996		CLOSE (55)
		CALL LIB$WAIT (10.)
		IM=IM+1
		IF (IM .GT. 10) GO TO 411
		GO TO 9011
C
	END IF
C
C
	DO 377 I=1,5
	DATA.MBTU(I)=MBTUS(I)
377	CONTINUE
C
	IF (JSHIFT .NE. 3) GO TO 411
C
	READ (55,REC=2,ERR=411)DATEX,MBTUS
C
	DO 2345 I=1,5
C
2345		DATA.DMBTU(I)=MBTUS(I)
C
C
411	CLOSE (55)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		subsection to read anval values
C
	do 244 m=1,3
c
		if (m .eq. 1) go to 441
c
		data.csio2(m)=anvalc(csil(m-1))
c
441		data.recov(m)=anvalc(crec(m))
c
		data.grind(m)=anvalc(cgr(m))
c
244	continue
C
	K=0
	DO 71 M=1,7
C
	I=FILT1(M)/32+1
	J=MOD(FILT1(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
71	CONTINUE
C
	DATA.FILOP(1)=K
C
C
	K=0
	DO 72 M=1,10
C
	I=FILT2X(M)/32+1
	J=MOD(FILT2X(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
72	CONTINUE
C
	DATA.FILOP(2)=K
C
C
	K=0
	DO 4472 M=1,12
C
	I=FILT3X(M)/32+1
	J=MOD(FILT3X(M),32)
		IF (BJTEST(CXSTS3(I),J)) K=K+1
4472	CONTINUE
C
	DATA.FILOP(3)=K
C
C
	K=0
	DO 73 M=1,6
C
	I=VAC1(M)/32+1
	J=MOD(VAC1(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
73	CONTINUE
C
	DATA.VAC(1)=K
C
C
	K=0
	DO 74 M=1,10
C
	I=VAC2(M)/32+1
	J=MOD(VAC2(M),32)
		IF (BJTEST(CXSTS(I),J)) K=K+1
74	CONTINUE
C
	DATA.VAC(2)=K
C
C
C
	K=0
	DO 7366 M=1,12
C
	I=VAC3(M)/32+1
	J=MOD(VAC3(M),32)
		IF (BJTEST(CXSTS3(I),J)) K=K+1
7366	CONTINUE
C
	DATA.VAC(3)=K
C
C
C	  FUEL OIL TANK GALLONS
	DATA.FOTANK=anval(39)
	DATA.FOTANK2=anval(39)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		subsection to read hourly values
C
C
	READ (10,REC=694) A,B
	if (B .LE. 0) GO TO 7416
	DATA.TOT203(1)=A/B
	DATA.TOT203(2)=A/B
7416	READ (10,REC=680) A,B
	IF (B .LE. 0) GOTO 6544
	DATA.TOT203(3)=A/B
C
6544	DO 100 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=BZSP(I))A,B
	IF (B .LE. 0) GO TO 100
	DATA.BZ(I)=A/B
	ELSE
	READ (40,REC=BZSP(I))A,B
	IF (B .LE. 0) GO TO 100
	DATA.BZ(I)=A/B
	END IF
C
100	CONTINUE
C
C
	DO 101 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=KESP(I))A,B
	IF (B .LE. 0) GO TO 101
	DATA.KE(I)=A/B
	ELSE
	READ (40,REC=KESP(I))A,B
	IF (B .LE. 0) GO TO 101
	DATA.KE(I)=A/B
	END IF
101	CONTINUE
C
C
	DO 102 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=PHF(I))A,B
	IF (B .LE. 0) GO TO 102
	DATA.PRE(I)=A/B
	ELSE
	READ (40,REC=PHF(I))A,B
	IF (B .LE. 0) GO TO 102
	DATA.PRE(I)=A/B
	END IF
102	CONTINUE
C
C
C
	DO 104 I=1,5
	IF (I .LT. 4) THEN
C
		IF (UGE(I) .GT. 0) THEN
			READ (10,REC=UGE(I))A,B
			IF (B .LE. 0) GO TO 104
			DATA.UGR(I)=A/B
		ELSE
			DATA.UGR(I)=0
		END IF
	ELSE
		IF (UGE(I) .GT. 0) THEN
			READ (40,REC=UGE(I))A,B
			IF (B .LE. 0) GO TO 104
			DATA.UGR(I)=A/B
		ELSE
			DATA.UGR(I)=0
		END IF
c
	END IF
C
C
	IF (I .LT. 4) THEN
		READ (10,REC=UGW(I))A,B
		IF (B .LE. 0) GO TO 104
		IF ((A/B) .GT. DATA.UGR(I)) DATA.UGR(I)=A/B
	ELSE
		READ (40,REC=UGW(I))A,B
		IF (B .LE. 0) GO TO 104
		IF ((A/B) .GT. DATA.UGR(I)) DATA.UGR(I)=A/B
	END IF
C
C
104	CONTINUE
C
	DO 105 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=DD1(I))A,B
	IF (B .LE. 0) GO TO 105
	DATA.DD1(I)=A/B
	ELSE
	READ (40,REC=DD1(I))A,B
	IF (B .LE. 0) GO TO 105
	DATA.DD1(I)=A/B
	END IF
105	CONTINUE
C
	DO 106 I=1,5
	IF (I .LT. 4) THEN
	IF (DD2(I) .LE. 0) GO TO 106
	READ (10,REC=DD2(I))A,B
	IF (B .LE. 0) GO TO 106
	DATA.DD2(I)=A/B
	ELSE
	IF (DD2(I) .LE. 0) GO TO 106
	READ (40,REC=DD2(I))A,B
	IF (B .LE. 0) GO TO 106
	DATA.DD2(I)=A/B
	END IF
106	CONTINUE
C
	DO 107 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=GSPD(I))A,B
	IF (B .LE. 0) GO TO 107
	DATA.GSPD(I)=A/B
	ELSE
	READ (40,REC=GSPD(I))A,B
	IF (B .LE. 0) GO TO 107
	DATA.GSPD(I)=A/B
	END IF
107	CONTINUE
C	
	DO 108 I=1,5
	IF (I .LT. 4) THEN
	READ (10,REC=BED(I))A,B
	IF (B .LE. 0) GO TO 108
	DATA.BED(I)=A/B
	ELSE
	READ (40,REC=BED(I))A,B
	IF (B .LE. 0) GO TO 108
	DATA.BED(I)=A/B
	END IF
108	CONTINUE
C	
	CLOSE (10)
	CLOSE (40)
C	
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		shift values
C
C
cccccccccccccccc
	DO 99 I=1,3
	READ (11,REC=GB(I))A,B
	IF (B .LE. 0) GO TO 446
	DATA.PROD(I)=A/B
99	CONTINUE
C
446	READ (41,REC=GB(4))A,B
	IF (B .LE. 0) GO TO 447
	DATA.PROD(4)=A/B
447	READ (41,REC=GB(5))A,B
	IF (B .LE. 0) GO TO 448
	DATA.PROD(5)=A/B
c
c
c 	remove step 2 reclaim  (per t. colarich, 23-jul-1990)
c	put back (per mike keppel 14-oct-2003)
c
cc448	data.reco(1)=0
cc	data.reco(2)=0
448	do 109 i=2,2
	READ (11,REC=RECL(I))A,B
109	DATA.RECI(I)=A
C
	DO 110 I=2,2
	READ (11,REC=TOPILE(I))A,B
110	DATA.RECO(I)=A
cCCCCCCCCCCC
C
C		COAL TONS
C
	READ (41,REC=521)A,B
	DATA.COALT(4)=A/2000.
	READ (41,REC=546)A,B
	DATA.COALT(5)=A/2000.
cccccccccccccccc
C
C		RECLAIM ACTIVITY- STEP 3
	READ (41,REC=524)A,B
	DATA.RECO(3)=A
	READ (41,REC=543)A,B
	DATA.RECI(3)=A
C
	DO 111 I=1,5	
	IF (I .LT. 4) READ (11,REC=PTNS(I))A,B
	IF (I .GE. 4) READ (41,REC=PTNS(I))A,B
111	DATA.PTONS(I)=A
C
	DO 112 I=1,5
	IF (I .LT. 4) READ (11,REC=BENT(I))A,B
	IF (I .GE. 4) READ (41,REC=BENT(I))A,B
	DATA.BENT(I)=A
112	CONTINUE
C
	DO 113 I=1,5
	IF (I .LT. 4) READ (11,REC=GCF(I))A,B
	IF (I .GE. 4) READ (41,REC=GCF(I))A,B
113	DATA.GASCF(I)=A
C
	DO 114 I=1,5
	IF (I .LT. 4) READ (11,REC=GH(I))A,B
	IF (I .GE. 4) READ (41,REC=GH(I))A,B
	IF (A .GT. 7.99) A=8.00		!Round up grate hours
114	DATA.GRATEHR(I)=A
C
	DATA.BALLHR(1)=0
	DATA.BALLHR(2)=0
	DATA.BALLHR(3)=0
	DATA.BALLHR(4)=0
	DATA.BALLHR(5)=0
C
	DO 115 I=1,4
	READ (11,REC=BDH3(I))A,B
115	DATA.BALLHR(1)=DATA.BALLHR(1)+A
C
C
	DO 116 I=1,5
	READ (11,REC=BDH4(I))A,B
116	DATA.BALLHR(2)=DATA.BALLHR(2)+A
C
C
	DO 117 I=1,5
	READ (11,REC=BDH5(I))A,B
117	DATA.BALLHR(3)=DATA.BALLHR(3)+A
C
	READ (41,REC=BDH6)A,B
	DATA.BALLHR(4)=A
	READ (41,REC=BDH7)A,B
	DATA.BALLHR(5)=A
C
	DO 118 I=1,3
	READ (11,REC=WTNS(I))A,B
118	DATA.WOODT(I)=A/2000.
C
	READ (41,REC=WTNS(4))A,B
	DATA.WOODT(4)=A/2000.
	READ (41,REC=WTNS(5))A,B
	DATA.WOODT(5)=A/2000.
C
	READ (41,REC=544,ERR=2293)A,B
	DATA.T42=A
C
C
C
C	  DD1 PRESSURES
C
2293	READ (11,REC=785,ERR=5881)A,B
	IF (B .GT. 0) DATA.DDP(1)=A/B
5881	READ (11,REC=124,ERR=589)A,B
	IF (B .GT. 0) DATA.DDP(2)=A/B
589	READ (11,REC=241,ERR=9590)A,B
	IF (B .GT. 0) DATA.DDP(3)=A/B
9590	READ (41,REC=84,ERR=9591)A,B
	IF (B .GT. 0) DATA.DDP(4)=A/B
9591	READ (41,REC=253,ERR=590)A,B
	IF (B .GT. 0) DATA.DDP(5)=A/B

C
C
C	FUEL OIL CONSUMPTION (GALLONS)
C
590	READ (11,REC=853,ERR=591)A,B
	IF (B .GT. 0) DATA.FUELOIL(1)=A
591	READ (11,REC=537,ERR=592)A,B
	IF (B .GT. 0) DATA.FUELOIL(2)=A
592	READ (11,REC=538,ERR=593)A,B
	IF (B .GT. 0) DATA.FUELOIL(3)=A
C
593	READ (41,REC=522,ERR=594)A,B
	IF (B .GT. 0) DATA.FUELOIL(4)=A
594	READ (41,REC=547,ERR=596)A,B
	IF (B .GT. 0) DATA.FUELOIL(5)=A
C
C
C	   037-0?-1 tons
596	DO 187 I=1,3
	READ (11,REC=TONS37(I),ERR=187)A,B
	IF (B .GT. 0) DATA.T37(I)=A/B
187	CONTINUE
C
C	   037-06 & 07
	DO 188 I=4,5
	READ (41,REC=TONS37(I),ERR=188)A,B
	IF (B .GT. 0) DATA.T37(I)=A/B
188	CONTINUE
C
C	    NOX FOR LINES 6&7
	READ (41,REC=676)A,B
	IF (B .GT. 0) DATA.NOX(4)=A/B
	READ (41,REC=677)A,B
	IF (B .GT. 0) DATA.NOX(5)=A/B
C
2294	CLOSE (11)
	CLOSE (41)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C		DAILY VALUES
C
	IF (JSHIFT .NE. 3) GO TO 499
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
c
C
499	OPEN (88,FILE='MET_SCREEN:SCREEN.DAT',
	1	ACCESS='KEYED',STATUS='old',shared,ERR=789,READONLY)
C
C
C		find latest date
C
	READ (88,KEYLT='99999999',IOSTAT=MMM) KD,DATF,IS,IH,SCREEN,COMP,
	1			    	    CAB,SIL,FILT2,
	1			    FILT3,BL2,BL3,FLUXG,FCA,FMG,FAL,FSI,   
	1			    PA,PC,PM,scwt                         
C
C
c
C

cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
C
	IF (IS .LT. 1 .OR. IS .GT. 3) GO TO 844
	IF (IH .LT. 1 .OR. IH .GT. 2) GO TO 844
C
C
	DO 544 I=1,5
		SUMA(I)=0.
		SUMB(I)=0.
		DATA.BT(I)=0.
		DATA.AT(I)=0.
		DATA.Q(I)=0.
		DATA.CMP(I)=0.
		DATA.M200(I)=0.
544	CONTINUE
C
C
	DO 2020 I=1,5
	DO 2020 J=1,7
		SUMB(I)=SUMB(I)+SCREEN(J,IS,IH,I)
		SUMA(I)=SUMA(I)+SCREEN(J+7,IS,IH,I)
2020	CONTINUE
C
C
	DO 200 I=1,5
	DO 200 J=1,5
		DATA.BT(I)=DATA.BT(I)+SCREEN(J,IS,IH,I)
		DATA.AT(I)=DATA.AT(I)+SCREEN(J+7,IS,IH,I)
200	CONTINUE
C
C
	DO 203 I=1,5
	IF (SUMB(I) .LE. 0) GO TO 292
	DATA.BT(I)=DATA.BT(I)/SUMB(I)*100.
292	IF (SUMA(I) .LE. 0) GO TO 203
	DATA.AT(I)=DATA.AT(I)/SUMA(I)*100.
203	CONTINUE
C
	DO 201 I=1,5
		DATA.Q(I)=(DATA.BT(I)*DATA.AT(I))/100.
201	CONTINUE
C
	DO 202 I=1,5
		DATA.CMP(I)=COMP(1,IS,IH,I)
		DATA.M200(I)=COMP(2,IS,IH,I)
202	CONTINUE
C
C
C		filter b/a and ratio
C
789   		IF ((FAL(1,IS)+FILT2(1,IS)) .LE. 0) GO TO 509
	DATA.BTA(1)=(FCA(1,IS)+FMG(1,IS))/(FAL(1,IS)+FILT2(1,IS))
	DATA.BTA(2)=(FCA(1,IS)+FMG(1,IS))/(FAL(1,IS)+FILT2(1,IS))
509		IF ((FAL(2,IS)+FILT3(1,IS)) .LE. 0) GO TO 620
	DATA.BTA(3)=(FCA(2,IS)+FMG(2,IS))/(FAL(2,IS)+FILT3(1,IS))
C
C
620	IF ((FCA(1,IS).LE.0) .OR. (FMG(1,IS).LE.0)) GO TO 4039
		DATA.RATIO(1)=((FCA(1,IS)+FMG(1,IS))-.6)/.5377
		DATA.RATIO(1)=DATA.RATIO(1)/(100.-DATA.RATIO(1))
		DATA.RATIO(2)=DATA.RATIO(1)
4039	IF ((FCA(2,IS).LE.0) .OR. (FMG(2,IS).LE.0)) GO TO 844
		DATA.RATIO(3)=((FCA(2,IS)+FMG(2,IS))-.6)/.5377
		DATA.RATIO(3)=DATA.RATIO(3)/(100.-DATA.RATIO(3))
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
844	CONTINUE
C
C
C
C
	vl(1)=0
	vl(4)=0
	DATA.FILOP(3)=VL(1)
	DATA.VAC(3)=VL(4)
CCCCCCCC	DATA.T42=VL(65)+VL(66)
C
C
C
C	  DAILY DD1 PRESSURES
C
	READ (12,REC=785,ERR=5331)A,B
	IF (B .GT. 0) DATA.DDPD(1)=A/B
5331	READ (12,REC=124,ERR=5489)A,B
	IF (B .GT. 0) DATA.DDPD(2)=A/B
5489	READ (12,REC=241,ERR=9594)A,B
	IF (B .GT. 0) DATA.DDPD(3)=A/B
9594	READ (42,REC=84,ERR=9595)A,B
	IF (B .GT. 0) DATA.DDPD(4)=A/B
9595	READ (42,REC=253,ERR=338)A,B
	IF (B .GT. 0) DATA.DDPD(5)=A/B
C
C
C
C
338	CLOSE (12)
	CLOSE (42)
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
	WRITE (75,REC=JSHIFT) DATA
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		COLLECT DATA FOR FOREMEN
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	  save data for each foreman
C
C
C
	OPEN   (UNIT=50,FILE='USER_D:[METREP.ASHIFT]FORFILE.DAT',
	1	STATUS='UNKNOWN',ORGANIZATION='INDEXED',ACCESS='KEYED',
	1	FORM='UNFORMATTED',RECL=256,KEY=(1:6:CHARACTER),
	1	SHARED)
C
C
741	DO 588 I=1,12
		IF (MN(I) .EQ. DATA.DATES(4:6)) GO TO 578
588	CONTINUE
C
	GO TO 1107
C
C
578	LLL=0
C
	ATIM(1:11)=DATA.DATES//'-'//DATA.YR

C
	CALL SYS$BINTIM (ATIM,BTIM)
C
	WRITE (KY(3:4), '(I2)') I
	IF (I .LT. 10) KY(3:4)='0'//KY(4:4)
C
	KY=DATA.YR(3:4)//KY(3:4)//DATA.DATES(1:2)
C
C
C
	READ (50,KEY=KY,IOSTAT=M,ERR=373) FOR
C
C
C
373	IF (M .EQ. 52) THEN
		LLL=LLL+1
		IF (LLL .GT. 10) GO TO 1107
		CALL LIB$WAIT(10.)
		GO TO 578
	END IF
C
	IF ((M .EQ. 36) .OR. (M .EQ. 0)) THEN
		GO TO 1108
	ELSE
		GO TO 1107
	END IF
C
C
C
1108	IF (M .EQ. 36) THEN
C
		FOR=ZFOR	!zero out structure
C
	END IF
C
C
C	
	FOR.DATE=KY
C
C
C	L=the crew number of the foreman for this shift
C
CCCCCCCCCCCCCCCCCCCCCCC
	CALL LIB$DAY (NOFD,BTIM,)  !get day no. of passed time
C
C
	DO 44 I=1,4    	! get day no. of 4 starting dates
C
	CALL SYS$BINTIM (FORD(I),CTIM)  !convert sched. date to binary
C
44		CALL LIB$DAY (FNOFD(I),CTIM,)
C
C
	DO 45 I=1,4                	! calc shift no. of the day passed
C                                       ! to 'ADATE' for all 4 crews
C
	SS(I)=NOFD-FNOFD(I)+1  	!calc no. of days from base to now
C
	SS(I)=MOD(SS(I),28)             !get remainder after divide by 28
C
	IF (SS(I) .EQ. 0) SS(I)=28      !if remain.=0 then remain=28
C
	SS(I)=LIST(SS(I))               !get corresp. shift no. from 'list'
C
45	CONTINUE
C
C
	ICNT=0
	DO 46 I=1,4
46	IF (SS(I) .EQ. 0) ICNT=ICNT+1
C
C
	IF (ICNT .NE. 1) GO TO 1107
C
C
CCCCCCCCCCCCCCCCCCCCCCC
		DO 522 L=1,4
			IF (SS(L) .EQ. JSHIFT) GO TO 955
522		CONTINUE
		GO TO 1107
C			
C
C
955	DO 444 IS=1,2		! loop thru for both steps
C
		FOR.NAME(JSHIFT,IS)=FORM(L,IS)		! name	
C
C
444	CONTINUE
C
C
	 		! save material type
		FOR.FA(1,JSHIFT)='F'
		FOR.FA(2,JSHIFT)='F'
		FOR.FA(3,JSHIFT)='F'
		IF (DATA.PELTYP(1).NE. 0) THEN
			FOR.FA(1,JSHIFT)='A'
			FOR.FA(2,JSHIFT)='A'
			FOR.FA(3,JSHIFT)='A'
		END IF
C
		FOR.FA(4,JSHIFT)='F'
		FOR.FA(5,JSHIFT)='F'
		IF (DATA.PELTYP(4).NE. 0) THEN
			FOR.FA(4,JSHIFT)='A'
			FOR.FA(5,JSHIFT)='A'
		END IF
C
c
	DO 383 I=1,5
		FOR.TONS(I,JSHIFT)=DATA.PTONS(I)
		FOR.TIME(I,JSHIFT)=DATA.GRATEHR(I)
		FOR.MBTU(I,JSHIFT)=DATA.MBTU(I)
		IF (DATA.PTONS(I) .LE. 0) GO TO 383
		FOR.BENT(I,JSHIFT)=DATA.BENT(I)/DATA.PTONS(I)
383	CONTINUE
C
	IF (M .EQ. 36) WRITE (50,ERR=1107) FOR
	IF (M .EQ. 0) REWRITE (50,ERR=1107) FOR
C
	CLOSE (50)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
1107	CLOSE (75)
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	send data to foremens office and step 2 control room (lta017:)
C
C
	STATUS=SYS$WAKE (,'AUTOSTART')
C
C
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C
C
	DO 476 II=1,4
476		AEF(II)=0.
C
C		READ IN THE AMINE EFFICIENCIES
C
	OPEN (UNIT=51,FILE='LOGS:CNC_SHIFT.DAT',STATUS='OLD',RECL=2,
	1	FORM='UNFORMATTED',ACCESS='DIRECT',USEROPEN=
	1	UFO_OPEN,SHARED,ERR=4588)
C
C
	READ (51,REC=1202,ERR=585)A,B
	IF (B .LE. 0) GO TO 585
	AEF(1)=A/B
585	READ (51,REC=1201,ERR=586)A,B
	IF (B .LE. 0) GO TO 586
	AEF(2)=A/B
586	READ (51,REC=1200,ERR=587)A,B
	IF (B .LE. 0) GO TO 587
	AEF(3)=A/B
587	READ (51,REC=1199,ERR=4588)A,B
	IF (B .LE. 0) GO TO 4588
	AEF(4)=A/B
C
4588	CLOSE (51)
C
C
cccccccccccccccccccccccccccccccccccccccccccccccccccccccccccccc
C
C
	WRITE (ASCSH,'(I1)') JSHIFT
	READ (AD(1:2),'(I2)') JDAY
C
C
C	GET MINE INDICATED SI02 FROM WJB EVERY SHIFT
C
C
	OPEN (UNIT=91,FILE='MET_P:HALFSIL2.DAT',STATUS='OLD',
	1	ACCESS='KEYED',SHARED,ERR=2999)
C
C
	HSKEY(1:2)=AD(10:11)
C
	DO 55 I=1,12
		IF (MN(I) .EQ. AD(4:6)) GO TO 551
55	CONTINUE
C
	GO TO 2999
C
C
551	write (HSKEY(3:4),'(I2)') I
C
	IF (HSKEY(3:3) .EQ. ' ') HSKEY(3:3)='0'
C
	READ (AD(1:2),'(I2)') ID
C
	LLC=0
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		save amine efficiencies for this shift
C
C
333	READ (91,KEY=HSKEY,IOSTAT=M) HSD
C
C
C
C
	IF (.not.(M .eq. 0 .OR. M .eq. 36)) THEN
		LLC=LLC+1
		IF (LLC .EQ. 10) GO TO 2999
		CALL LIB$WAIT(2.)
		GO TO 333
	END IF
C
	DO 8083 IK=1,4
8083		HSD.AEFF(IK,JSHIFT,JDAY)=AEF(IK)	! AMINE EFFICIENCY
C
C
	IF (M .EQ. 36) THEN
		HSD.KEY=HSKEY
		WRITE (91) HSD
	ELSE
		REWRITE (91) HSD
	END IF
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C	read strend file for the all 3 shifts and collect all data from
c	it to store in halfsil2.dat for tom larson
c
C
C
	IF (JSHIFT .EQ. 1) THEN
C
C
		CALL SYS$BINTIM (AD,BBD)
C
		CALL LIB$SUB_TIMES (BBD,B1,BBD)
C
		CALL SYS$ASCTIM (,ADOLD,BBD,)
		IF (ADOLD(1:1) .EQ. ' ') ADOLD(1:1)='0'
C
		READ (ADOLD(1:2),'(I2)') JDAY
C
C
C
C
	HSKEY(1:2)=ADOLD(10:11)
C
	DO 455 I=1,12
		IF (MN(I) .EQ. ADOLD(4:6)) GO TO 4551
455	CONTINUE
C
	GO TO 2999
C
C
4551	write (HSKEY(3:4),'(I2)') I
C
	IF (HSKEY(3:3) .EQ. ' ') HSKEY(3:3)='0'
C
	READ (ADOLD(1:2),'(I2)') ID
C
C
C
C
4333	READ (91,KEY=HSKEY,IOSTAT=M) HSD
C
C
C
	IF (.not.(M .eq. 0 .OR. M .eq. 36)) THEN
		LLC=LLC+1
		IF (LLC .EQ. 10) GO TO 2999
		CALL LIB$WAIT(2.)
		GO TO 4333
	END IF
C
C
C
	OPEN (UNIT=90,FILE='LOGS:STREND.DAT',STATUS='OLD',ACCESS='DIRECT',
	1	SHARED,USEROPEN=UFO_OPEN,ERR=2999)
c
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
C
C
C
	DO 6000 MZ=1,10
C
C
C
C
	READ (90,REC=MZ,ERR=3006)DATEX,VALU
C
		GO TO 4411
C
3006		CLOSE (90)
		GO TO 2999
C
C
C		see if bill's file has the same date as this
c			program does.
C
4411		IF (DATEX(1:11) .NE. ADOLD(1:11)) GO TO 6000
C
C
C
	READ (DATEX(12:12),'(I1)') JSHIFT
C
	LLC=0
C
C
C
	HSD.KEY=HSKEY			! YYMM
C
	HSD.MSIL(JSHIFT,JDAY)=VALU(3) 	! SAVE MINE IND. SILICA
C
C
	HSD.FLFR(JSHIFT,JDAY)=VALU(14)
	HSD.FLFS(JSHIFT,JDAY)=VALU(15)
	HSD.FLS(JSHIFT,JDAY)=VALU(12)
C
C
C
6000	CONTINUE
C
C
	IF (M .EQ. 36) THEN
		WRITE (91) HSD
	ELSE
		REWRITE (91) HSD
	END IF
C
	CLOSE (90)
	close (91)
C
	END IF
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C		turn on PSMAUDIT to collect data for spcpsm1, 2, & 3
cccccc2999	call lib$spawn ('run user_d:[metrep.gks]psmaudit',,,FLAG)
C
2999	continue
C
3000	CALL  SYS$HIBER()	!wait for next time period
C
	GO TO 2500
	END
