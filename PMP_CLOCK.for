C
	PROGRAM	PMP_CLOCK	!PUMPS CLOCK
C
C	LINK PMP_CLOCK,PMP_CLOCK/OPT
C
	IMPLICIT NONE
C
	INCLUDE	'($PRCDEF)'
C
	INTEGER*4	I,J,K,L,M,N,UFO_OPEN
	INTEGER*4	CXSTS(100),BIT
	INTEGER*4	SECS,PM2230/81000/,PM2400/86400/
	INTEGER*4	CNTR,FIVMIN/300/,TEMP,ADRS(2)
	INTEGER*4	CX(288)/593,594,595,596,597,598,599,600,
	1			601,602,603,604,605,606,607,608,
	1			609,610,611,612,613,614,615,616,
	1			617,618,619,620,621,622,623,624,
	1			625,
C
	1			832,833,834,835,836,837,838,839,
	1			840,841,842,843,844,845,846,847,
	1			848,849,850,851,852,853,855,857,
	1			859,861,863,865,867,869,871,873,
	1			875,
C
	1			-909,-911,-913,-915,-917,-919,
	1			-921,-923,-925,-927,-929,-931,
	1			-933,-935,-937,-939,-941,-943,
	1			-945,-947,-949,-951,-953,-955,
	1			-957,-959,-961,-963,-965,-967,
C
	1		1156,1159,1160,1161,1162,1163,1164,1165,
	1		1166,1167,1168,1169,1170,1682,1171,1172,
	1		1173,1174,1175,1176,1177,1178,1179,1180,
	1		1181,1182,1183,1184,1185,1186,1187,1188,
	1		1189,
C
	1		-1253,-1255,-1257,-1259,-1261,-1263,
	1		-1265,-1267,-1269,-1271,-1273,-1275,
	1		-1277,-1279,-1281,-1283,-1285,-1287,
	1		-1289,-1291,-1293,-1295,-1297,-1299,
	1		-1301,-1303,-1305,-1307,-1309,-1311,
C
	1		1562,1564,1567,1569,1570,1572,0,
	1		0,-1577,1579,1584,1583,1588,1555,
	1		1552,1551,1556,1553,-1557,-1559,1566,
C
	1		0,0,0,1444,1445,1443,1683,1446,1447,
	1		1448,1450,1451,1452,1454,1455,1458,1462,1465,
	1		1468,1470,1472,1474,1476,1478,1480,1482,1484,
C
	1		308,309,
C
	1		753,754,755,756,757,759,758,760,
C
	1		761,762,763,
C
	1		1488,1489,1490,1491,1492,1493,1494,1495,
	1		1496,1497,1498,1499,1500,1501,1502,1503,
C
	1		1508,1509,1510,1511,1512,1513,1514,1515,
	1		1518,1519,1520,1521,1522,1523,1524,1525,
	1		1526,1527,1528,1529,1532,1533,1535,1536,
	1		1537,1538,1539,1540,1541,1542,1543,1544,
C
	1		1686,1686,
C
	1		0,0,
C
	1		1143,1145,-1783,-1787,1785,1786,-1789,-1791,
	1		-1799,-1801,1859,1860,-1880,-1882,328,330/
C
	REAL*4		RSECS,OHRS(2)
C
	CHARACTER*8	TIM/'0 0:5:00'/
	CHARACTER*12	PRGNAM/'PUMPS:CPUMPZ'/
	CHARACTER*6	PRCNAM/'CPUMPZ'/
	CHARACTER*12	ENUM
C
	COMMON/CONTACTSCNC/CXSTS
C
	EXTERNAL	UFO_OPEN
C
	RSECS=SECNDS(0.0)	!SECONDS SINCE MIDNIGHT
	SECS=RSECS		!CONVERT TO INTEGER
	TEMP=PM2230-SECS	!CALCULATE FIVE MINUTE SCANS TILL 10:30PM
	IF (TEMP .LT. 0)TEMP=TEMP+PM2400
	CNTR=TEMP/FIVMIN
C
	CNTR=CNTR+2	!FORCE DAY TO END AFTER 10:30 PM
C
	CALL	SYS$BINTIM(TIM,ADRS)
	CALL	SYS$SCHDWK(,,ADRS,ADRS)	!SCHEDULE 5 MIN WAKEUP
C
200	CONTINUE
C
	OPEN	(UNIT=1,FILE='PUMPS:PMP_CLOCK.DAT',
	1	STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1	RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C

	DO 1000	I=1,288	!FOR EACH PUMP
C
		READ	(1,REC=I)ENUM,OHRS	!OPER TIME FOR THIS CLASSIFIER
C
		IF (CX(I) .EQ. 0)GOTO 1000	!IF NO CX THEN SKIP THIS PUMP
C
		J=(ABS(CX(I))/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(ABS(CX(I)),32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 1)THEN
			OHRS(1)=OHRS(1)+0.08331	!5 MIN OF OPER TIME
			WRITE	(1,REC=I)ENUM,OHRS	!CHANGE RECORD
			GOTO 1000
		END IF
C
		IF (CX(I) .GE. 0)GOTO 1000	!IF CX NUM POSITIVE ... DONE
C
		TEMP=ABS(CX(I))+1	!MUST CHECK TO SEE IF VFD PICKED UP
C
		J=(TEMP/32)+1	!EXTRACT CXSTS LONGWORD
		K=MOD(TEMP,32)	!EXTRACT CORRECT BIT
		BIT=JIBITS(CXSTS(J),K,1)	!EXTRACT BIT CONDITION
C
		IF (BIT .EQ. 1)THEN
			OHRS(1)=OHRS(1)+0.08331	!5 MIN OF OPER TIME
			WRITE	(1,REC=I)ENUM,OHRS	!CHANGE RECORD
			GOTO 1000
		END IF
C
1000	CONTINUE
C
	CLOSE	(UNIT=1)
C

	CNTR=CNTR-1	!DECREMENT SCAN COUNTER
C
	IF (CNTR .LE. 0)THEN
		CNTR=288	!RESET SCAN COUNTER
C
		OPEN	(UNIT=1,FILE='PUMPS:PMP_CLOCK.DAT',
	1		STATUS='OLD',FORM='UNFORMATTED',ACCESS='DIRECT',
	1		RECL=5,RECORDTYPE='FIXED',SHARED,USEROPEN=UFO_OPEN)
C
		DO 1200	I=1,288
			READ	(1,REC=I)ENUM,OHRS
			OHRS(2)=OHRS(1)  	!SAVE 24 HR RESULTS
			OHRS(1)=0		!ZERO NEW 24 HR PERIOD
			WRITE	(1,REC=I)ENUM,OHRS
1200		CONTINUE
C
		CLOSE	(UNIT=1)
C
		CALL	SYS$CREPRC(,PRGNAM,,,,,,PRCNAM,%VAL(4),,,
	1		%VAL(PRC$M_DETACH.OR.PRC$M_NOACNT))
C
	END IF
C
	CLOSE	(UNIT=1)
C
	CALL	SYS$HIBER()
	GOTO 200
C
	END
