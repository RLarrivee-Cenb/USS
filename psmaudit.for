	EXTERNAL UFO_OPEN
C
	INTEGER*4 	VAR,TIM,YR,DY,MTH,LX
	REAL*4		LM270,M270,SOLS
	INTEGER*4 	VAR2,TIM2,YR2,DY2,MTH2,LX2
	REAL*4		LM2702,M2702,SOLS2
C
C
	STRUCTURE /X/
C
		INTEGER 	TIME(2)
		CHARACTER       SAMPLE*3
		REAL 		PSM,LAB,SOLID
		INTEGER*2	VAR
C
	END STRUCTURE
C
	RECORD /X/ D1,DD,DS1,DS2,DS3
C
C
	CHARACTER KY*7,MON(12)*3/'JAN','FEB','MAR','APR','MAY','JUN','JUL',
	1	'AUG','SEP','OCT','NOV','DEC'/, ADAT*23,AHR*2,AMIN*2,MUN*3,
	1	AD*23
C
	INTEGER TM(2)
C
	CHARACTER ASTIM*14 /'-- 02:50:00.00'/, AINTV*1 /'1'/
	integer		rtim(2),intv(2)
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C   			schedule a wake-up call
C                                                                      
CCC	CALL SYS$BINTIM (ASTIM,RTIM) !convert 23:40 time to binary
C
CCC	CALL SYS$BINTIM (AINTV,INTV) !convert 24 hr interval to binary
C
CCC	CALL SYS$SCHDWK (,,RTIM,INTV) !sched. a wakeup at 23:40 every day
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
242	OPEN (UNIT=77,FILE='ANA:PAUDIT.DAT',STATUS='OLD',
	1	FORM='UNFORMATTED',SHARED,ACCESS='DIRECT',
	1	USEROPEN=UFO_OPEN,READONLY)
C
C
1512	OPEN	(UNIT=10,FILE='DISK0:[METREP.GKS]PSMAUDIT1.DAT',
	1	FORM='UNFORMATTED',ACCESS='DIRECT',RECL=25,
	1	STATUS='UNKNOWN',ERR=220)
C
	GO TO 1513
220	CALL LIB$WAIT (1.)
	GO TO 1512
C
1513	OPEN	(UNIT=11,FILE='DISK0:[METREP.GKS]PSMAUDIT2.DAT',
	1	FORM='UNFORMATTED',ACCESS='DIRECT',RECL=25,
	1	STATUS='UNKNOWN',ERR=221)
C
	GO TO 1514
221	CALL LIB$WAIT (1.)
	GO TO 1513
C
1514	OPEN	(UNIT=12,FILE='DISK0:[METREP.GKS]PSMAUDIT3.DAT',
	1	FORM='UNFORMATTED',ACCESS='DIRECT',RECL=25,
	1	STATUS='UNKNOWN',ERR=2227)
C
	GO TO 1515
2227	CALL LIB$WAIT (1.)
	GO TO 1514
C
1515	OPEN	(UNIT=13,FILE='DISK0:[METREP.GKS]LASTPSM.DAT',
	1	FORM='UNFORMATTED',ACCESS='DIRECT',RECL=9,
	1	RECORDTYPE='FIXED',STATUS='UNKNOWN')
C
C
C
C
C
C
C
	IPASS1=0
	IPASS2=0
	IPASS3=0
C
	LN1=0
	LN2=0
	LN3=0
C
	DO 1000  MN=1,42
C
C
C
C
399	READ (77,REC=MN,ERR=99) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
C
	IF (YR .LE. 0) GO TO 1000
C
C
	IF (LX .LT. 7) THEN
C
C
	IF (IPASS1 .NE. 0) GO TO 1000 !LAST ENTRY TO BE SAVED HAS BEEN
C					REACHED, BYPASS.
C
	IF (LN1 .EQ. 0) LN1=MN !SAVE THE LATEST ENTRY FOR THIS STEP
C
	READ (13,REC=1,ERR=56) LX2,M2702,SOLS2,TIM2,MTH2,DY2,
	1						YR2,VAR2,LM2702
C
56	IF (LX .EQ. LX2 .AND. TIM .EQ. TIM2 .AND. MTH .EQ. MTH2 .AND.
	1	DY .EQ. DY2 .AND. YR .EQ. YR2) THEN
C
ccccccc		READ (77,REC=LN1) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
ccccccc		WRITE(13,REC=1) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
C
		IPASS1=1
		GO TO 1000
C
	END IF
C
	IM=MTH
	ID=DY
	IY=MOD(YR,100)
	IHR=TIM/100
	IMIN=MOD(TIM,100)
C
C
	WRITE (KY(1:1),'(I1)') ISTEP
	WRITE (KY(2:3),'(I2)') IY
	IF (KY(2:2) .EQ. ' ') KY(2:2)='0'
	WRITE (KY(4:5),'(I2)') IM
	IF (KY(4:4) .EQ. ' ')KY(4:4)='0'
	WRITE (KY(6:7),'(I2)') ID
	IF (KY(6:6) .EQ. ' ')KY(6:6)='0'
	WRITE (AHR,'(I2)') IHR
	IF (AHR(1:1) .EQ. ' ') AHR(1:1)='0'
	WRITE (AMIN,'(I2)') IMIN
	IF (AMIN(1:1) .EQ. ' ') AMIN(1:1)='0'
C
	ADAT='99-MMM-YYYY HH:MM:00.00'
	ADAT(1:17)=KY(6:7)//'-'//MON(IM)//'-20'//KY(2:3)//' '
	1					//AHR//':'//AMIN
C
	CALL SYS$BINTIM(ADAT,D1.TIME)
C
C
	WRITE (D1.SAMPLE,'(I2)') LX
C
	D1.PSM=M270
	D1.LAB=LM270
	D1.SOLID=SOLS
	D1.VAR=VAR
C
C
C
C
	IF (D1.PSM .GT. 0) THEN
	READ (10,REC=1,ERR=7222)DD
		GO TO 223
C
7222		DD.TIME(1)=1
		WRITE (10,REC=1)DD
C
223		DD.TIME(1)=DD.TIME(1)+1
		LL=DD.TIME(1)
		WRITE (10,REC=1)DD
C
C
70	WRITE (10,REC=LL) D1
	END IF
C
C
C
C
	END IF
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
222	IF (LX .GE. 7 .AND. LX .LE. 12) THEN
C
C
	IF (IPASS2 .NE. 0) GO TO 1000
C
	IF (LN2 .EQ. 0) LN2=MN
C
	READ (13,REC=2,ERR=57) LX2,M2702,SOLS2,TIM2,MTH2,DY2,
	1						YR2,VAR2,LM2702
C
57	IF (LX .EQ. LX2 .AND. TIM .EQ. TIM2 .AND. MTH .EQ. MTH2 .AND.
	1	DY .EQ. DY2 .AND. YR .EQ. YR2) THEN
C
cccccc		READ (77,REC=LN2) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
cccccc		WRITE(13,REC=2) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
C
		IPASS2=1
		GO TO 1000
C
	END IF
C
C
C
	IM=MTH
	ID=DY
	IY=MOD(YR,100)
	IHR=TIM/100
	IMIN=MOD(TIM,100)
C
C
	WRITE (KY(1:1),'(I1)') ISTEP
	WRITE (KY(2:3),'(I2)') IY
	IF (KY(2:2) .EQ. ' ')KY(2:2)='0'
	WRITE (KY(4:5),'(I2)') IM
	IF (KY(4:4) .EQ. ' ')KY(4:4)='0'
	WRITE (KY(6:7),'(I2)') ID
	IF (KY(6:6) .EQ. ' ')KY(6:6)='0'
	WRITE (AHR,'(I2)') IHR
	IF (AHR(1:1) .EQ. ' ') AHR(1:1)='0'
	WRITE (AMIN,'(I2)') IMIN
	IF (AMIN(1:1) .EQ. ' ') AMIN(1:1)='0'
C
	ADAT='99-MMM-YYYY HH:MM:00.00'
	ADAT(1:17)=KY(6:7)//'-'//MON(IM)//'-20'//KY(2:3)//' '
	1				//AHR//':'//AMIN
C
	CALL SYS$BINTIM(ADAT,D1.TIME)
C
C
	WRITE (D1.SAMPLE,'(I2)') LX
C
	D1.PSM=M270
	D1.LAB=LM270
	D1.SOLID=SOLS
	D1.VAR=VAR
C
	IF (D1.PSM .GT. 0) THEN
	READ (11,REC=1,ERR=1222)DD
		GO TO 1223
C
1222		DD.TIME(1)=1
		WRITE (11,REC=1)DD
C
1223		DD.TIME(1)=DD.TIME(1)+1
		LL=DD.TIME(1)
		WRITE (11,REC=1)DD
C
C
170	WRITE (11,REC=LL) D1
	END IF
C
C
C
C
	END IF
C
C
C
CCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCCC
C
C
333	IF (LX .GE. 13 .AND. LX .LE. 18) THEN
C
	IF (IPASS3 .NE. 0) GO TO 1000
C
	IF (LN3 .EQ. 0) LN3=MN
C
	READ (13,REC=3,ERR=58) LX2,M2702,SOLS2,TIM2,MTH2,DY2,
	1						YR2,VAR2,LM2702
C
58	IF (LX .EQ. LX2 .AND. TIM .EQ. TIM2 .AND. MTH .EQ. MTH2 .AND.
	1	DY .EQ. DY2 .AND. YR .EQ. YR2) THEN
C
cccccc		READ (77,REC=LN3) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
cccccc		WRITE(13,REC=3) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
C
		IPASS3=1
		GO TO 1000
C
	END IF
C
C
	IM=MTH
	ID=DY
	IY=MOD(YR,100)
	IHR=TIM/100
	IMIN=MOD(TIM,100)
C
C
	WRITE (KY(1:1),'(I1)') ISTEP
	WRITE (KY(2:3),'(I2)') IY
	IF (KY(2:2) .EQ. ' ')KY(2:2)='0'
	WRITE (KY(4:5),'(I2)') IM
	IF (KY(4:4) .EQ. ' ')KY(4:4)='0'
	WRITE (KY(6:7),'(I2)') ID
	IF (KY(6:6) .EQ. ' ')KY(6:6)='0'
	WRITE (AHR,'(I2)') IHR
	IF (AHR(1:1) .EQ. ' ') AHR(1:1)='0'
	WRITE (AMIN,'(I2)') IMIN
	IF (AMIN(1:1) .EQ. ' ') AMIN(1:1)='0'
C
	ADAT='99-MMM-YYYY HH:MM:00.00'
	ADAT(1:17)=KY(6:7)//'-'//MON(IM)//'-20'//KY(2:3)//' '
	1					//AHR//':'//AMIN
C
	CALL SYS$BINTIM(ADAT,D1.TIME)
C
C
	WRITE (D1.SAMPLE,'(I2)') LX
C
	D1.PSM=M270
	D1.LAB=LM270
	D1.SOLID=SOLS
	D1.VAR=VAR
C
	IF (D1.PSM .GT. 0) THEN
	READ (12,REC=1,ERR=2222)DD
		GO TO 2223
C
2222		DD.TIME(1)=1
		WRITE (12,REC=1)DD
C
2223		DD.TIME(1)=DD.TIME(1)+1
		LL=DD.TIME(1)
		WRITE (12,REC=1)DD
C
C
270	WRITE (12,REC=LL) D1
	END IF
C
C
C
C
	END IF
C
C
C
C
1000	CONTINUE
C
99	CONTINUE
		READ (77,REC=LN1,ERR=706) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
		WRITE(13,REC=1) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
706		READ (77,REC=LN2,ERR=80) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
		WRITE(13,REC=2) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
80		READ (77,REC=LN3,ERR=441) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270
		WRITE(13,REC=3) LX,M270,SOLS,TIM,MTH,DY,YR,VAR,LM270

441	close (77)
	close (10)
	close (11)
	close (12)
	close (13)
c
	CALL LIB$WAIT (300.)
C
	GO TO 242
C
C
C
	END
