********************************************************************************
C	This program is used by the MES program to obtain an up to date
C	list of equipment numbers and descriptions.  It runs as a detached 
C	process 1/day at 06:00, and dumps data into a file called 
C	OIL:ORDER.DAT.
********************************************************************************
	PROGRAM		NUM_UPDATE
C
      	INTEGER*2	CLASS(9)/1,3,8,11,13,19,20,23,28/	!Classes at MES
	INTEGER*2	ICLASS,INUM,I,X
C
	STRUCTURE /EQUIPMENT_FILE/ 
		CHARACTER*6	NUM	!(1:2)CLASS (3:6)NUM
		CHARACTER*4	WNUM	!WENCO EQUIPMENT NUMBER
		CHARACTER*4	WNUM2	!2ND WENCO EQUIPMENT NUMBER
		CHARACTER*3	WF	!WENCO FLEET DESIGNATION
		CHARACTER*3	WT	!WENCO TYPE DESIGNATION
		CHARACTER*2	SUB	!SUB-GROUP NUMBER
		CHARACTER*2	MFR	!MANUFACTURER NUMBER
		CHARACTER*20	DESCR	!DESCRIPTION
		REAL*4		HRS_LTD	!LIFE TO DATE HRS
		INTEGER*4	DATE(2)	!DATE OF LAST HRS UPDATE
		REAL*8		TOTAL_TONS	!(NOT LTD TONS!)
	END STRUCTURE
	RECORD /EQUIPMENT_FILE/ EHRS
C
	STRUCTURE /DATA/
		CHARACTER*3	NUM
		CHARACTER*20	DESCR
	END STRUCTURE
	RECORD /DATA/ EQUIP
	OPEN (UNIT=3,FILE='EHOURS:MINE_EQUIP.DAT',
	1	STATUS='OLD',
	1	ACCESS='KEYED',
	1	SHARED)
C
!	CALL LIB$DELETE_FILE ( 'OIL:ORDER.DAT.1' )
C
10	OPEN (UNIT=15,FILE='OIL:ORDER.DAT',STATUS='UNKNOWN',
	1	ORGANIZATION='INDEXED',ACCESS='KEYED',
	1	KEY=(1:3),SHARED,RECL=9,ERR=15)
	GOTO 16
C
15	OPEN (UNIT=15,FILE='OIL:ORDER.DAT',STATUS='NEW',
	1	ORGANIZATION='INDEXED',ACCESS='KEYED',
	1	KEY=(1:3),SHARED,RECL=9)
	GOTO 10
C 	
16	READ (UNIT=15,KEYID=0,KEYGE='   ',ERR=30)
	DELETE (UNIT=15)
C
20	READ (UNIT=15,END=30)
	DELETE (UNIT=15)
	GOTO 20
C
!	CALL LIB$SPAWN ( 'SET FILE/PROT=W:RWED OIL:ORDER.DAT' )
C
30	X = 1
C
	READ (UNIT=3,KEYID=0,KEYGE='000000',ERR=9999) EHRS
	UNLOCK (UNIT=3)
C
	READ (EHRS.NUM(1:2),'(I2,BN)') ICLASS
	READ (EHRS.NUM(3:6),'(I4,BN)') INUM
C	

	DO I=1,9                                       
	        IF (ICLASS .EQ. CLASS(I)) THEN         
	                EQUIP.NUM = EHRS.NUM(4:6)             
			IF (EQUIP.NUM(1:1).EQ.'0') 
	1			EQUIP.NUM(1:1) = ' '
			EQUIP.DESCR = EHRS.DESCR
			WRITE (UNIT=15) EQUIP
			GOTO 200
	        END IF                                 
	END DO                                         
C               
200	READ (UNIT=3,END=9999) EHRS
	UNLOCK (UNIT=3)
C
	READ (EHRS.NUM(1:2),'(I2,BN)') ICLASS
	READ (EHRS.NUM(3:6),'(I4,BN)') INUM
C	
	DO I=1,9
		IF (ICLASS .EQ. CLASS(I)) THEN
	                EQUIP.NUM = EHRS.NUM(4:6)             
			IF (EQUIP.NUM(1:1).EQ.'0') 
	1			EQUIP.NUM(1:1) = ' '
			EQUIP.DESCR = EHRS.DESCR
			WRITE (UNIT=15) EQUIP
			GOTO 200
		END IF
	END DO
C
	GOTO 200
C
9999   	CLOSE (UNIT=3)
	CLOSE (UNIT=15)
C
	END
